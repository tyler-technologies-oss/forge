import{C as x,l as w,j as B,k as P,K as H}from"./constants-DzQy6WDX.js";import{c as h,B as K}from"./base-adapter-C8aSF3nG.js";import"./service-adapter-CffG5Lhq.js";import{t as N,n as M,c as b,q as z,u as W,j as u,D as T,C as I,l as q,P as F,o as $,z as G,b as j}from"./feature-detection-B-sRDmdg.js";import{G as X,I as Y,F as Q,Q as Z,R as J}from"./icon-kuXwuZAY.js";import{D as ee}from"./divider-NNdF1g4c.js";import"./index-5CPwzmQS.js";import{a as te}from"./linear-progress-r0Hzg69v.js";import{L as ie,a as se}from"./list-u_j869sm.js";import{L as ne,a as A}from"./list-dropdown-aware-core-2gGoZ7Z1.js";import{a as S,P as oe}from"./popover-BWVazmya.js";import{a as re}from"./skeleton-BSiuL_ME.js";import{B as ae,l as le,a as pe,T as g,b as he}from"./text-field-COqDLaMN.js";import{F as m,a as de,b as ce,B as _e}from"./base-field-CRqwZkGO.js";import"./focus-indicator-BC5BEuUe.js";import{L as ue}from"./label-C-kHiLFY.js";import"./button-CJ5YWwCL.js";import"./state-layer-gAgMwMHF.js";import"./button-toggle-group-BAovUuzx.js";import"./checkbox-DiSqW2_u.js";import"./icon-button-CQgGxtJo.js";import"./switch-Bin0Siuv.js";import{C as me}from"./chip-set-CkVOx4SC.js";import{d as fe,s as k,o as ge}from"./utils-Bd6MGx91.js";import{a as be,c as Ee}from"./list-dropdown-8i5RFGYo.js";import"./overlay-B5pGv-rV.js";const D=`${x}chip-field`,R={ADD_ON_BLUR:"add-on-blur"},Oe={...R},we={CONTAINER:".container",INPUT:"input",MEMBER_SLOT:"slot[name=member]",MEMBER:"[slot=member]"},ve={HAS_MEMBERS:"has-members"},Le={MEMBER_ADDED:`${D}-member-added`,MEMBER_REMOVED:`${D}-member-removed`},ye=["disabled","placeholder"],De={LABEL:"LABEL"},c={elementName:D,observedAttributes:R,attributes:Oe,selectors:we,classes:ve,events:Le,observedInputAttributes:ye,tagNames:De};class Ce extends ae{get hasValue(){return!!this._component.querySelector(c.selectors.MEMBER)||this.hasInputValue}get hasPlaceholder(){return!!this._inputElement?.placeholder}get hasInputValue(){return!!this._inputElement?.value}get inputHasFocus(){return!!this._inputElement?.matches(":focus")}get inputElement(){return this._inputElement}get popoverTargetElement(){return this._popoverTargetElement||(this._popoverTargetElement=w(this._fieldElement,m.selectors.POPOVER_TARGET)),this._popoverTargetElement}constructor(e){super(e),this._fieldElement=w(e,m.elementName),this._containerElement=w(e,c.selectors.CONTAINER),this._memberSlot=w(e,c.selectors.MEMBER_SLOT),this._fieldElement.setAttribute("exportparts",Object.values(m.parts).join(", "))}initialize(){this._inputElement=this._component.querySelector("input:not([type=checkbox]):not([type=radio])")}addRootListener(e,t,i){this._fieldElement.addEventListener(e,t,i)}removeRootListener(e,t,i){this._fieldElement.removeEventListener(e,t,i)}addInputListener(e,t){this._inputElement?.addEventListener(e,t)}removeInputListener(e,t){this._inputElement?.removeEventListener(e,t)}clickInput(){this._inputElement?.click()}tryAddValueChangeListener(e,t){this._destroyValueChangerListener?.(),this._inputElement&&(this._destroyValueChangerListener=le(e,this._inputElement,"value",t))}removeValueChangeListener(){this._destroyValueChangerListener?.()}focusInput(){this._inputElement?.focus()}getSlottedMemberElements(){return this._memberSlot.assignedElements()}click(){this.focusInput()}applyLabel(e){this._inputElement&&N(this._inputElement,!!e,"aria-label",e??"")}tryFloatLabel(e){if(e!==void 0){this._component.floatLabel=e;return}this._component.floatLabel=this.hasValue||this.hasPlaceholder}handleDefaultSlotChange(e,t){this._inputMutationObserver?.disconnect();const i=e.assignedElements();this._inputElement=i.find(s=>s.matches(c.selectors.INPUT)),this._inputElement&&(this._component.disabled&&(this._inputElement.disabled=!0),this._inputMutationObserver=new MutationObserver(s=>{s.forEach(n=>{if(n.attributeName){const _=n.target.getAttribute(n.attributeName),l=n.attributeName;t(l,_)}})}),this._inputMutationObserver?.observe(this._inputElement,{attributes:!0,attributeFilter:[...c.observedInputAttributes]}),Object.values(c.observedInputAttributes).forEach(s=>{const n=s;this._inputElement&&t(n,this._inputElement.getAttribute(n))}))}tryConnectSlottedLabel(e){if(!this._inputElement)return;const t=e.assignedElements({flatten:!0}),i=t.find(a=>a.matches(ue.elementName));if(i){i.forElement=this._component,i.clickTarget=this._inputElement;return}const s=t.find(a=>a.tagName===c.tagNames.LABEL);if(!s||s.control)return;const n=this._inputElement.id||`forge-input-${M()}`;this._inputElement.id=n,s.htmlFor=n}toggleContainerClass(e,t){this._containerElement.classList.toggle(e,t)}setDisabled(e){this._inputElement&&(this._inputElement.disabled=e)}}class Te extends pe{constructor(e){super(e),this._addOnBlur=!1,this._mouseDownListener=this._onMouseDown.bind(this),this._clickListener=this._onClick.bind(this),this._rootKeyDownListener=this._onRootKeyDown.bind(this),this._inputKeyDownListener=this._onKeyDown.bind(this),this._slotChangeListener=this._onSlotChange.bind(this),this._inputAttributeListener=this._onInputAttributeChange.bind(this),this._valueChangeListener=this._onValueChange.bind(this),this._inputListener=this._onValueChange.bind(this),this._blurListener=this._onBlur.bind(this)}initialize(){this._adapter.initialize(),this._adapter.addRootListener("mousedown",this._mouseDownListener,{capture:!0}),this._adapter.addRootListener("click",this._clickListener),this._adapter.addRootListener("keydown",this._rootKeyDownListener),this._adapter.addInputListener("keydown",this._inputKeyDownListener),this._adapter.addRootListener("slotchange",this._slotChangeListener),this._adapter.addRootListener("input",this._inputListener),this._adapter.tryAddValueChangeListener(this,this._valueChangeListener),this._addOnBlur&&this._adapter.addInputListener("blur",this._blurListener)}destroy(){this._adapter.removeRootListener("mousedown",this._mouseDownListener,{capture:!0}),this._adapter.removeRootListener("click",this._clickListener),this._adapter.removeRootListener("keydown",this._rootKeyDownListener),this._adapter.removeInputListener("keydown",this._inputKeyDownListener),this._adapter.removeRootListener("slotchange",this._slotChangeListener),this._adapter.removeRootListener("input",this._inputListener),this._adapter.removeInputListener("blur",this._blurListener),this._adapter.removeValueChangeListener()}_onBlur(e){const t=e.target;this._addOnBlur&&this._addMember(t),t.value=""}_onMouseDown(e){if(this._disabled||this._adapter.inputHasFocus){e.preventDefault(),e.stopPropagation();return}}_onClick(e){this._disabled||e.target!==this._adapter.inputElement&&(this._adapter.focusInput(),this._adapter.clickInput())}_onValueChange(){this._tryFloatLabel()}_onSlotChange(e){const t=e.target;switch(t.name){case"label":this._adapter.tryConnectSlottedLabel(t);break;case"member":this._adapter.toggleContainerClass(c.classes.HAS_MEMBERS,t.assignedElements().length>0),this._adapter.tryFloatLabel(),this._adapter.getSlottedMemberElements().forEach(i=>i.tabIndex=-1);break;case"":this._adapter.handleDefaultSlotChange(t,this._inputAttributeListener),this._adapter.tryAddValueChangeListener(this,this._valueChangeListener),this._tryFloatLabel();break}}_onInputAttributeChange(e,t){switch(e){case"disabled":this.disabled=t!==null;break;case"placeholder":this._tryFloatLabel();break}}_onRootKeyDown({key:e}){if(!this._adapter.hasInputValue)switch(e){case"ArrowRight":this._focusNextMember();break;case"ArrowLeft":this._focusPreviousMember();break;case"Backspace":case"Delete":this._removeMember();break}}_onKeyDown({target:e,key:t}){const i=e;switch(t){case"Enter":this._addMember(i);break;case"Escape":i.value="";break;case"Tab":this._addOnBlur||(i.value="");break}}_focusNextMember(){const e=this._adapter.getSlottedMemberElements();if(!(!e.length||this._adapter.inputHasFocus))for(let t=0;t<e.length;t++){const i=e.at(t),s=e.at(t+1);if(i&&this._isMemberActive(i))if(s){s.focus();break}else this._adapter.focusInput()}}_focusPreviousMember(){const e=this._adapter.getSlottedMemberElements();if(e.length){if(this._adapter.inputHasFocus){e[e.length-1].focus();return}for(let t=0;t<e.length;t++){const i=e.at(t-1),s=e.at(t);if(s&&this._isMemberActive(s)&&i){i.focus();break}}}}_isMemberActive(e){return e.matches(":focus-within")}_getActiveMember(){return this._adapter.getSlottedMemberElements().find(t=>this._isMemberActive(t))??null}_addMember(e){const t=e.value.trim();t.length>0&&this._adapter.emitHostEvent(c.events.MEMBER_ADDED,t),e.value=""}_removeMember(){let e=this._getActiveMember();e||(e=this._adapter.getSlottedMemberElements().at(-1)),e&&(this._focusNextMember(),this._adapter.emitHostEvent(c.events.MEMBER_REMOVED,e))}get addOnBlur(){return this._addOnBlur}set addOnBlur(e){e=!!e,this._addOnBlur!==e&&(this._addOnBlur=e,this._adapter.isConnected&&(this._addOnBlur?this._adapter.addInputListener("blur",this._blurListener):this._adapter.removeInputListener("blur",this._blurListener)),this._adapter.toggleHostAttribute(c.attributes.ADD_ON_BLUR,this._addOnBlur))}get popoverTargetElement(){return this._adapter.popoverTargetElement}get disabled(){return super.disabled}set disabled(e){this.disabled!==e&&(super.disabled=e,this._adapter.setDisabled(e))}}const Ie=`<template>
  <forge-field id="field" multiline>
    <slot slot="label" name="label"></slot>
    <slot slot="start" name="start"></slot>
    <div class="container" data-forge-field-input>
      <slot name="member"></slot>
      <slot></slot>
    </div>
    <slot slot="end" name="end"></slot>
    <slot slot="accessory" name="accessory"></slot>
    <slot slot="support-text" name="support-text"></slot>
    <slot slot="support-text-end" name="support-text-end"></slot>

    <!-- Include deprecated leading alias -->
    <slot slot="start" name="leading"></slot>
    <!-- Include deprecated trailing alias -->
    <slot slot="end" name="trailing"></slot>
    <!-- Include deprecated addon-end alias -->
    <slot slot="accessory" name="addon-end"></slot>
    <!-- Include deprecated helper-text alias -->
    <slot slot="support-text" name="helper-text"></slot>
  </forge-field>
</template>
`,Fe="@keyframes float-in-label-animation{0%{translate:0;opacity:40%}to{translate:var(--_field-floating-label-translation);opacity:100%}}@keyframes float-out-label-animation{0%{translate:var(--_field-floating-label-translation);opacity:40%}to{translate:0;opacity:100%}}@keyframes multiline-inset-label-background-animation{0%{opacity:0%}to{opacity:100%}}:host{display:block}:host([hidden]){display:none}forge-field{--_chip-field-member-spacing: var(--forge-chip-field-member-spacing, var(--forge-spacing-xsmall, 8px));--_chip-field-content-spacing: var(--forge-chip-field-content-spacing, var(--forge-spacing-xxsmall, 4px))}.container{display:flex;flex-wrap:wrap;align-items:center;gap:var(--_chip-field-member-spacing);block-size:auto}.container.has-members{margin-block:var(--_chip-field-content-spacing)}.container.has-members ::slotted(input){block-size:auto;inline-size:auto}::slotted(input){flex-grow:1;cursor:inherit;box-sizing:border-box;margin:0;outline:none;border:none;background-color:transparent;padding-block:0;padding-inline:0;inline-size:100%;block-size:100%;color:inherit;font:inherit;font-size:var(--_field-font-size);text-overflow:ellipsis;padding-block-start:0;padding-block-end:0;transition:padding-block var(--_field-floating-animation-duration) var(--_field-floating-animation-timing)}forge-field{display:contents;--forge-field-multiline-resize: none}forge-field::part(label):after{content:none}:host([theme=primary]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-primary, #3f51b5);--forge-chip-field-color: var(--forge-theme-on-primary, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-primary, #3f51b5)}:host([theme=secondary]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-secondary, #ffc107);--forge-chip-field-color: var(--forge-theme-on-secondary, #000000);--forge-chip-focus-indicator-color: var(--forge-theme-secondary, #ffc107)}:host([theme=tertiary]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-tertiary, #3d5afe);--forge-chip-field-color: var(--forge-theme-on-tertiary, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-tertiary, #3d5afe)}:host([theme=success]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-success, #2e7d32);--forge-chip-field-color: var(--forge-theme-on-success, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-success, #2e7d32)}:host([theme=warning]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-warning, #d14900);--forge-chip-field-color: var(--forge-theme-on-warning, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-warning, #d14900)}:host([theme=error]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-error, #b00020);--forge-chip-field-color: var(--forge-theme-on-error, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-error, #b00020)}:host([theme=info]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-info, #1565c0);--forge-chip-field-color: var(--forge-theme-on-info, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-info, #1565c0)}";var Ae=Object.defineProperty,Se=Object.getOwnPropertyDescriptor,U=(r,e,t,i)=>{for(var s=i>1?void 0:i?Se(e,t):e,n=r.length-1,a;n>=0;n--)(a=r[n])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&Ae(e,t,s),s};let C=class extends ce{static get observedAttributes(){return[...Object.values(_e.observedAttributes),...Object.values(c.observedAttributes)]}constructor(){super(),P(this,Ie,Fe),this._core=new Te(new Ce(this))}connectedCallback(){this._core.initialize()}disconnectedCallback(){this._core.destroy()}attributeChangedCallback(r,e,t){switch(super.attributeChangedCallback(r,e,t),r){case c.attributes.ADD_ON_BLUR:this.addOnBlur=b(t);return}}get popoverTargetElement(){return this._core.popoverTargetElement}click(){this._core.click()}};U([h()],C.prototype,"addOnBlur",2);C=U([B({name:c.elementName,dependencies:[de,me]})],C);const y=`${x}autocomplete`,ke={MODE:"mode",MULTIPLE:"multiple",DEBOUNCE:"debounce",FILTER_ON_FOCUS:"filter-on-focus",FILTER_FOCUS_FIRST:"filter-focus-first",ALLOW_UNMATCHED:"allow-unmatched",POPUP_TARGET:"popup-target",OPEN:"open",MATCH_KEY:"match-key",FILTER_TEXT:"filter-text"},xe={INPUT:"input",DROPDOWN_ICON:"[data-forge-dropdown-icon],[data-forge-dropdown-icon],[forge-dropdown-icon],.forge-dropdown-icon",CLEAR_BUTTON:"[data-forge-autocomplete-clear],[forge-autocomplete-clear]"},Be={DEFAULT_DEBOUNCE_TIME:H},Pe={CHANGE:`${y}-change`,SELECT:`${y}-select`,SCROLLED_BOTTOM:`${y}-scrolled-bottom`},o={elementName:y,attributes:ke,selectors:xe,numbers:Be,events:Pe};var E=(r=>(r.Default="default",r.Stateless="stateless",r))(E||{});class Ne extends K{constructor(e){super(e),this.setInputElement()}get inputElement(){return this._inputElement}setInputElement(){const e=z(this._component,o.selectors.INPUT,!1);return e.length&&(this._inputElement=e[0]),this._inputElement}setInputAttribute(e,t){this._inputElement.setAttribute(e,t)}addInputListener(e,t){this._inputElement.addEventListener(e,t)}removeInputListener(e,t){this._inputElement.removeEventListener(e,t)}initializeInputAccessibility(e){this._inputElement.setAttribute("autocomplete","off"),this._inputElement.setAttribute("role","combobox"),this._inputElement.setAttribute("aria-live","polite"),this._inputElement.setAttribute("aria-atomic","true"),this._inputElement.setAttribute("aria-haspopup","true"),this._inputElement.setAttribute("aria-expanded","false"),this._inputElement.setAttribute("aria-autocomplete","list"),fe(),k(this._inputElement)}isWrappingChipField(){return!!this._component.querySelector(c.elementName)}show(e,t){this._targetElement=this._getTargetElement(t),this._targetElement&&(this._listDropdown=new be(this._targetElement,e),this._listDropdown.open(),this._inputElement.setAttribute("aria-expanded","true"),this._inputElement.setAttribute("aria-controls",`list-dropdown-popup-${e.id}`),this._tryToggleDropdownIconRotation(!0))}async hide(e,{destroy:t=!1}={}){if(this.setBusyVisibility(!1),this._tryToggleDropdownIconRotation(!1),this._inputElement?.removeAttribute("aria-activedescendant"),this._inputElement?.setAttribute("aria-expanded","false"),k(this._inputElement),!this._listDropdown)return;const{anchorElement:i}=this._listDropdown.dropdownElement;i&&i instanceof HTMLElement&&i?.removeEventListener(S.events.TOGGLE,e),t?this._listDropdown.destroy():await this._listDropdown.close(),this._listDropdown=void 0}setBusyVisibility(e){this._listDropdown?.setBusyVisibility(e)}setDismissListener(e){this._listDropdown?.dropdownElement?.addEventListener(S.events.TOGGLE,e)}focus(){window.requestAnimationFrame(()=>this._inputElement.focus())}setOptions(e){this._listDropdown?.setOptions(e)}appendOptions(e){this._listDropdown?.appendOptions(e)}setSelectedText(e){this._inputElement.value=e}getInputValue(){return this._inputElement.value}setInputValue(e){this._inputElement.value=e}selectInputValue(){window.requestAnimationFrame(()=>this._inputElement.select())}isFocusWithinPopup(e){return!this._listDropdown||!this._listDropdown.dropdownElement?!1:this._listDropdown.dropdownElement.contains(e)}hasFocus(){const e=W(this._component.ownerDocument);return e===this._inputElement||this.isFocusWithinPopup(e)}hasInputElement(){return!!this._inputElement}setDropdownIconListener(e,t){window.requestAnimationFrame(()=>{const i=this._component.querySelector(g.elementName);if(i&&(i.popoverIcon||i.hasAttribute(m.attributes.POPOVER_ICON))){const n=e==="mousedown"?m.events.POPOVER_ICON_MOUSEDOWN:m.events.POPOVER_ICON_CLICK;this._component.addEventListener(n,t)}this._component.querySelector(o.selectors.DROPDOWN_ICON)?.addEventListener(e,t)})}removeDropdownIconListener(e,t){this._component.removeEventListener(m.events.POPOVER_ICON_CLICK,t),this._component.querySelector(o.selectors.DROPDOWN_ICON)?.removeEventListener(e,t)}setClearButtonListener(e,t){window.requestAnimationFrame(()=>{const i=this._component.querySelector(g.elementName);i&&(i.showClear||i.hasAttribute(g.attributes.SHOW_CLEAR))&&this._component.addEventListener(g.events.CLEAR,t);const s=this._component.querySelector(o.selectors.CLEAR_BUTTON);s&&s.addEventListener(e,t)})}removeClearButtonListener(e,t){this._component.removeEventListener(g.events.CLEAR,t),this._component.querySelector(o.selectors.CLEAR_BUTTON)?.removeEventListener(e,t)}propagateKey(e){this._listDropdown?.handleKey(e)}updateActiveDescendant(e){this._targetElement&&N(this._inputElement,!!e,"aria-activedescendant",e)}getTargetElementWidth(e){return this._targetElement||(this._targetElement=this._getTargetElement(e)),this._targetElement.getBoundingClientRect().width}getPopupElement(){return this._listDropdown?.dropdownElement??null}activateFirstOption(){this._listDropdown?.activateFirstOption()}activateSelectedOption(){this._listDropdown?.activateSelectedOption()}activateOptionByIndex(e){this._listDropdown?.activateOption(e)}getActiveOptionIndex(){return this._listDropdown?.getActiveOptionIndex()??null}clearActiveOption(){this._listDropdown?.clearActiveOption()}setSelectedOptions(e){if(this._listDropdown){const t=e.map(i=>i.value);this._listDropdown.setSelectedValues(t)}}queueDropdownPositionUpdate(){this.getPopupElement()&&window.requestAnimationFrame(()=>{this.getPopupElement()?.position()})}_getTargetElement(e){return e?this._component.querySelector(e)||this._getDefaultTargetElement():this._getDefaultTargetElement()}_getDefaultTargetElement(){const e=this._tryGetFieldLikeChild();return e?.popoverTargetElement?e.popoverTargetElement:this._component.querySelector("input")||this._component}_tryToggleDropdownIconRotation(e){const t=this._tryGetFieldLikeChild();t?.popoverIcon&&(t.popoverExpanded=e);const i=this._component.querySelector(o.selectors.DROPDOWN_ICON);i&&(i.style.transition="transform 120ms linear",i.style.transform=e?"rotateZ(180deg)":"")}_tryGetFieldLikeChild(){const e=[g.elementName,c.elementName];return this._component.querySelector(`:is(${e.join(",")})`)}}var O=(r=>(r[r.Option=0]="Option",r[r.Group=1]="Group",r))(O||{});function v(r,e){const t=(n,a)=>Object.prototype.hasOwnProperty.call(n,a),i=r.some(n=>u(n)&&T(n)&&t(n,"options")&&(t(n,"text")||t(n,"builder"))),s=r.some(n=>u(n)&&T(n)&&t(n,"label")&&t(n,"value"));return i&&e===1||s&&e===0}function Me(r,e){return r.find(t=>t.value===e)}function L(r,e,t=null){return t?!(t in r.value)||!(t in e)?!1:I(r.value[t],e[t]):I(r.value,e)}class Re extends ne{constructor(e){super(),this._adapter=e,this._isInitialized=!1,this._isDropdownOpen=!1,this._mode=E.Default,this._multiple=!1,this._debounce=o.numbers.DEFAULT_DEBOUNCE_TIME,this._allowUnmatched=!1,this._filterOnFocus=!0,this._filterFocusFirst=!0,this._options=[],this._filterText="",this._selectedOptions=[],this._values=[],this._pendingFilterPromises=[],this._matchKey=null,this._clickListener=t=>this._onClick(t),this._focusListener=()=>this._onFocus(),this._blurListener=t=>this._onBlur(t),this._keydownListener=t=>this._onKeydown(t),this._dropdownIconClickListener=t=>this._onDropdownIconClick(t),this._dropdownScrollEndListener=()=>this._onDropdownScrollEnd(),this._dropdownIconMouseDownListener=t=>this._onDropdownIconMouseDown(t),this._clearButtonListener=t=>this._onClear(t),this._dismissListener=()=>this._onDismiss(),this._activeChangeListener=t=>this._adapter.updateActiveDescendant(t),this._targetWidthCallback=()=>this._adapter.getTargetElementWidth(this._popupTarget),this._identifier=M()}async initialize(){if(!this._adapter.hasInputElement()&&!this._adapter.setInputElement())throw new Error("An input element is required as a child of the autocomplete component.");if(this._setInputListener(),this._setFilterCallback(),this._attachListeners(),this._initializeAccessibility(),this._values.length){if(!this._selectedOptions.length){try{await this._executeFilter()}catch(e){console.error(e)}this._updateSelectedOptions(this._values)}this._adapter.setSelectedText(this._getSelectedText())}this._isInitialized=!0}destroy(){this._isInitialized&&(this._detachListeners(),this._isInitialized=!1),this._closeDropdown({destroy:!0})}async forceFilter({preserveValue:e}){this._options=[],await this._executeFilter(!0,!0),e&&this._options.push(...this._selectedOptions),this._applyValue(this._values)}_attachListeners(){this._adapter.addInputListener("click",this._clickListener),this._adapter.addInputListener("focus",this._focusListener),this._adapter.addInputListener("blur",this._blurListener),this._adapter.addInputListener("input",this._inputListener),this._adapter.addInputListener("keydown",this._keydownListener),this._adapter.setDropdownIconListener("click",this._dropdownIconClickListener),this._adapter.setDropdownIconListener("mousedown",this._dropdownIconMouseDownListener),this._adapter.setClearButtonListener("click",this._clearButtonListener)}_detachListeners(){this._adapter.removeInputListener("click",this._clickListener),this._adapter.removeInputListener("focus",this._focusListener),this._adapter.removeInputListener("blur",this._blurListener),this._adapter.removeInputListener("input",this._inputListener),this._adapter.removeInputListener("keydown",this._keydownListener),this._adapter.removeDropdownIconListener("click",this._dropdownIconClickListener),this._adapter.removeDropdownIconListener("mousedown",this._dropdownIconMouseDownListener),this._adapter.removeClearButtonListener("click",this._clearButtonListener)}_setInputListener(){this._inputListener=e=>this._onInput(e)}_setFilterCallback(){this._filterFn=u(this._debounce)&&this._debounce>0?q(this._debounceFilter,this._debounce,!1):this._debounceFilter}_initializeAccessibility(){this._adapter.initializeInputAccessibility(this._identifier)}get _flatOptions(){return v(this._options,O.Group)?this._options.reduce((e,t)=>e.concat(t.options),[]):this._options}_onClick(e){!this._isDropdownOpen&&this._filterOnFocus?this._showDropdown():this._closeDropdown()}_onDropdownIconMouseDown(e){e.preventDefault()}_onDropdownIconClick(e){this._isDropdownOpen?this._closeDropdown():(this._adapter.focus(),window.requestAnimationFrame(()=>this._showDropdown()))}_onClear(e){this._filterText="",this._clearValue(),this._adapter.setSelectedText(this._getSelectedText())}_onDropdownScrollEnd(){this._adapter.emitHostEvent(o.events.SCROLLED_BOTTOM)}_onFocus(){!this._isDropdownOpen&&this._adapter.getInputValue()&&!F.isMobile&&this._adapter.selectInputValue()}_onBlur(e){this._adapter.isFocusWithinPopup(e.relatedTarget)||this._applyBlur()}_applyBlur(){this._isDropdownOpen&&this._closeDropdown(),this._mode!==E.Stateless&&(this._selectedOptions.length?this._adapter.setSelectedText(this._getSelectedText()):this._allowUnmatched||(this._filterText="",this._adapter.setSelectedText("")))}_onInput(e){this._selectedOptions.length&&!this._multiple&&(!this._adapter.getInputValue()||this._allowUnmatched)&&!this._adapter.isWrappingChipField()&&(this._selectedOptions=[],this._values=[],this._emitChangeEvent()),this._filterText=this._adapter.getInputValue(),this._filterFn()}async _debounceFilter({checkFocus:e=!0}={}){if(!e&&!this._adapter.hasFocus()){this._pendingFilterPromises=[],this._isDropdownOpen&&this._closeDropdown();return}const t=this._filterText,i=this._executeFilter();this._pendingFilterPromises.push(i),this._isDropdownOpen?this._adapter.setBusyVisibility(!0):this._showDropdown({filter:!1});try{await i}catch{this._pendingFilterPromises=[],this._isDropdownOpen&&this._closeDropdown();return}if(t===this._filterText)this._pendingFilterPromises=[],this._onFilterComplete();else{const s=this._pendingFilterPromises.indexOf(i);s!==-1&&this._pendingFilterPromises.splice(s,1)}}_onKeydown(e){switch(e.key){case"Tab":this._isDropdownOpen&&!this._multiple&&this._selectActiveOption(!1);break;case"Esc":case"Escape":this._isDropdownOpen&&(e.preventDefault(),e.stopPropagation(),this._closeDropdown());break;case"Down":case"ArrowDown":e.preventDefault(),this._isDropdownOpen?this._adapter.propagateKey(e.key):this._showDropdown({activateFirst:!0,activateSelected:!0});break;case"Up":case"ArrowUp":e.preventDefault(),this._isDropdownOpen&&this._adapter.propagateKey(e.key);break;case"Enter":case"Home":case"End":this._isDropdownOpen&&(e.key==="Enter"&&e.stopPropagation(),e.preventDefault(),this._adapter.propagateKey(e.key));break;case"Backspace":case"Delete":{const t=e.target,i=this._adapter.getInputValue(),s=t.value.substring(t.selectionStart,t.selectionEnd)===t.value,n=i.length===1&&t.selectionEnd===1,a=i.length===1&&t.selectionEnd===0,_=!i||s||n||a;!this._adapter.isWrappingChipField()&&_&&!this._multiple&&this._values.length&&this._clearValue();break}}}_executeFilter(e=!0,t=!1){if(!this._filter||typeof this._filter!="function")throw new Error('A filter callback must be provided. Did you set the "filter" property?');const i=this._filter,s=e?this._filterText:"",n=t?this._getValue():null;return new Promise((a,_)=>Promise.resolve(i(s,n)).then(l=>{this._options=l,a(this._options)}).catch(l=>_(`An unexpected error occurred while filtering: ${l}`)))}_onFilterComplete(){if(!this._adapter.hasFocus()){this._isDropdownOpen&&this._closeDropdown();return}if(this._options.length){const e=this._allowUnmatched&&!this._selectedOptions.length;this._dropdownReady({userTriggered:e}),this._filterFocusFirst&&this._filterText&&this._adapter.activateFirstOption()}else this._closeDropdown()}_clearValue(){this._selectedOptions=[],this._values=[],this._isDropdownOpen&&(this._adapter.setSelectedOptions([]),this._adapter.clearActiveOption()),this._emitChangeEvent()}async _showDropdown({filter:e=!0,userTriggered:t=!0,activateFirst:i=!1,activateSelected:s=!1}={}){if(!this._isInitialized||!this._adapter.hasInputElement())return;const n=this._allowUnmatched&&!this._selectedOptions.length;this._isDropdownOpen=!0;let a;if(this._optionBuilder){const l=this._optionBuilder;a=(f,V)=>l(f,this._filterText,V)}const _={options:this._options,referenceElement:this._adapter.inputElement,multiple:this._multiple,selectedValues:[...this._values],id:`forge-autocomplete-${this._identifier}`,asyncStyle:Ee.Skeleton,headerBuilder:this._popupHeaderBuilder,footerBuilder:this._popupFooterBuilder,transform:l=>{if(this._filterText){const f=ge(l,this._filterText);if(f)return f}return l},allowBusy:!0,optionBuilder:a,optionLimit:this._optionLimit,popupClasses:this._popupClasses,syncWidth:this._syncPopupWidth,constrainViewportWidth:this._constrainPopupWidth,wrapOptionText:this._wrapOptionText,observeScroll:this._observeScroll,observeScrollThreshold:this._observeScrollThreshold,popupPlacement:this._popoverPlacement,popupOffset:this._popoverOffset,popupFlip:this._popoverFlip,popupShift:this._popoverShift,popupFallbackPlacements:this._popoverFallbackPlacements,scrollEndListener:this._dropdownScrollEndListener,activeChangeCallback:this._activeChangeListener,targetWidthCallback:this._targetWidthCallback,selectCallback:l=>this._onSelect(l),closeCallback:()=>this._closeDropdown()};if(this._adapter.show(_,this._popupTarget),this._adapter.toggleHostAttribute(o.attributes.OPEN,this._isDropdownOpen),e){this._options.length&&this._adapter.setBusyVisibility(!0);try{await this._executeFilter(n)}catch(l){console.error(l)}this._updateSelectedOptions(this._values)}this._pendingFilterPromises.length||this._dropdownReady({userTriggered:t,activateFirst:i,activateSelected:s})}_dropdownReady({userTriggered:e=!0,activateFirst:t=!1,activateSelected:i=!1}={}){if(!this._isDropdownOpen||!this._options.length||e&&!this._adapter.hasFocus()){this._closeDropdown();return}this._sortSelectedOptions(),this._adapter.setBusyVisibility(!1),this._adapter.setOptions(this._options),this._adapter.setSelectedOptions(this._selectedOptions),this._adapter.setDismissListener(this._dismissListener),i&&this._selectedOptions.length?this._adapter.activateSelectedOption():t&&this._adapter.activateFirstOption()}_closeDropdown({destroy:e=!1}={}){this._multiple&&(this._filterText=""),this._isDropdownOpen=!1,this._adapter.hide(this._dismissListener,{destroy:e}),this._sortSelectedOptions(),this._adapter.toggleHostAttribute(o.attributes.OPEN,this._isDropdownOpen)}_sortSelectedOptions(){if(this._multiple&&this._selectedOptions.length&&v(this._options,O.Option)){const e=[],t=[];this._options.forEach(i=>{this._selectedOptions.find(s=>L(s,i.value,this._matchKey))?e.push(i):t.push(i)}),this._options=[...e,...t]}}async _onSelect(e,t=!0){if(this._valueChanging)return;if(this._mode===E.Stateless){const s={value:e};this._adapter.emitHostEvent(o.events.SELECT,s,!0,!0)&&(this._filterText="",this._multiple||this._closeDropdown());return}const i=()=>{const n=this._flatOptions.find(l=>L(l,e,this._matchKey)),a=n?n.value:"",_=n?n.label:"";if(this._multiple){const l=Me(this._selectedOptions,a);if(l){const f=this._selectedOptions.indexOf(l);this._selectedOptions.splice(f,1)}else this._selectedOptions.push(n)}else u(a)?(this._selectedOptions[0]=n,this._filterText=_):(this._selectedOptions=[],this._filterText="");this._isDropdownOpen&&this._adapter.setSelectedOptions(this._selectedOptions),this._values=this._selectedOptions.map(l=>l.value),this._adapter.setSelectedText(this._getSelectedText()),!F.isMobile&&t&&this._adapter.selectInputValue(),this._emitChangeEvent(),this._tryUpdateDropdownPosition()};this._isDropdownOpen&&!this._multiple&&this._closeDropdown(),typeof this._beforeValueChange=="function"?(this._valueChanging=Promise.resolve(this._beforeValueChange.call(null,e,this._matchKey)),await this._valueChanging?i():this._tryUpdateDropdownPosition(),this._valueChanging=void 0):i()}_selectActiveOption(e=!0){const t=this._adapter.getActiveOptionIndex();if(typeof t=="number"&&t>=0){const i=this._flatOptions[t];i&&this._onSelect(i.value,e)}}_emitChangeEvent(){this._adapter.emitHostEvent(o.events.CHANGE,this._getValue(),!0)}_tryUpdateDropdownPosition(){this._isDropdownOpen&&this._adapter.queueDropdownPositionUpdate()}_getValue(){return this._values?this._values.length?this._multiple?[...this._values]:this._values[0]:this._multiple?[]:null:null}_getSelectedText(){return this._adapter.isWrappingChipField()?"":this._selectedTextBuilder?this._selectedTextBuilder(this._selectedOptions):this._multiple?this._values.length?this._values.length===1?this._selectedOptions[0]?.label??"":`${this._values.length} options selected`:"":this._selectedOptions.filter(e=>e&&e.label).map(e=>e.label).join(" ").trim()}_onDismiss(){this._closeDropdown()}async _applyValue(e){let t=[];this._selectedOptions=[],Array.isArray(e)?t=e:t=u(e)?[e]:[],!this._multiple&&t.length>1&&(t=[t[0]]),v(t,O.Option)?(this._values=t.map(s=>s.value),this._selectedOptions=t):this._values=t;const i=this._flatOptions;if(t.length&&i.length&&this._updateSelectedOptions(t),this._values.length&&!this._selectedOptions.length&&this._filter&&this._isInitialized){try{await this._executeFilter(!1,!0)}catch(s){console.error(s)}this._updateSelectedOptions(this._values)}this._multiple?this._filterText="":this._filterText=this._selectedOptions.length?this._selectedOptions[0].label:"",this._isInitialized&&this._adapter.setSelectedText(this._getSelectedText()),this._isDropdownOpen&&this._adapter.setSelectedOptions(this._selectedOptions)}_updateSelectedOptions(e){const t=[...this._flatOptions,...this._selectedOptions];if(this._selectedOptions.length&&(this._selectedOptions=[]),v(e,O.Option))for(const i of e){const s=t.find(n=>L(n,i.value,this._matchKey));s?this._selectedOptions.push(s):this._selectedOptions.push(i)}else for(const i of e){const s=t.find(n=>L(n,i,this._matchKey));s?this._selectedOptions.push(s):this._allowUnmatched&&this._selectedOptions.push({label:i,value:i})}}get mode(){return this._mode}set mode(e){this._mode!==e&&(this._mode=e,this._mode===E.Stateless&&(this._selectedOptions=[],this._isDropdownOpen&&this._closeDropdown()),this._adapter.setHostAttribute(o.attributes.MODE,this._mode))}get multiple(){return this._multiple}set multiple(e){this._multiple!==e&&(this._multiple=e,this._adapter.setHostAttribute(o.attributes.MULTIPLE,u(this._multiple)?this._multiple.toString():""))}get value(){return this._getValue()}set value(e){let t=[];e==null?t=[]:Array.isArray(e)?t=structuredClone(e):$(e)?t=[e]:t=[structuredClone(e)],(t.length!==this._values.length||t.some(s=>!this._values.includes(s)))&&this._applyValue(e)}get filterOnFocus(){return this._filterOnFocus}set filterOnFocus(e){this._filterOnFocus!==e&&(this._filterOnFocus=e,this._adapter.setHostAttribute(o.attributes.FILTER_ON_FOCUS,u(this._filterOnFocus)?this._filterOnFocus.toString():""))}get filterFocusFirst(){return this._filterFocusFirst}set filterFocusFirst(e){this._filterFocusFirst!==e&&(this._filterFocusFirst=e,this._adapter.toggleHostAttribute(o.attributes.FILTER_FOCUS_FIRST,this._filterFocusFirst))}get allowUnmatched(){return this._allowUnmatched}set allowUnmatched(e){this._allowUnmatched!==e&&(this._allowUnmatched=e,u(this._allowUnmatched)&&this._adapter.setHostAttribute(o.attributes.ALLOW_UNMATCHED,this._allowUnmatched.toString()))}get matchKey(){return this._matchKey}set matchKey(e){this._matchKey!==e&&(this._matchKey=e)}get popupTarget(){return this._popupTarget}set popupTarget(e){this._popupTarget!==e&&(this._popupTarget=e)}get filterText(){return this._filterText}set filterText(e){this._filterText!==e&&(this._filterText=this._allowUnmatched?e:"",this._isInitialized&&this._allowUnmatched&&(this._adapter.setInputValue(this._filterText),this._isDropdownOpen&&this._debounceFilter({checkFocus:!1})))}get popupClasses(){return Array.isArray(this._popupClasses)?[...this._popupClasses]:[this._popupClasses]}set popupClasses(e){this._popupClasses!==e&&(this._popupClasses=Array.isArray(e)?[...e]:[e])}set popupHeaderBuilder(e){this._popupHeaderBuilder=e}set popupFooterBuilder(e){this._popupFooterBuilder=e}get syncPopupWidth(){return this._syncPopupWidth}set syncPopupWidth(e){this._syncPopupWidth!==e&&(this._syncPopupWidth=e)}get optionLimit(){return this._optionLimit}set optionLimit(e){this._optionLimit!==e&&(this._optionLimit=e)}get debounce(){return this._debounce}set debounce(e){this._debounce!==e&&(this._debounce=e,this._isInitialized&&this._setFilterCallback(),this._adapter.setHostAttribute(o.attributes.DEBOUNCE,u(this._debounce)?this._debounce.toString():""))}get optionBuilder(){return this._optionBuilder}set optionBuilder(e){this._optionBuilder=e}get filter(){return this._filter}set filter(e){this._filter!==e&&(this._filter=e,this._isInitialized&&this._values.length&&!this._flatOptions.length&&this._filter&&this._executeFilter().then(()=>{this._updateSelectedOptions(this._values),this._adapter.setSelectedText(this._getSelectedText())}))}get selectedTextBuilder(){return this._selectedTextBuilder}set selectedTextBuilder(e){this._selectedTextBuilder=e,this._selectedOptions.length&&this._adapter.setSelectedText(this._getSelectedText())}get observeScroll(){return this._observeScroll}set observeScroll(e){this._observeScroll=e}get observeScrollThreshold(){return this._observeScrollThreshold}set observeScrollThreshold(e){this._observeScrollThreshold=e}appendOptions(e){this._isDropdownOpen&&(this._options=[...this._options,...e],this._adapter.appendOptions(e))}get isInitialized(){return this._isInitialized}get open(){return this._isDropdownOpen}set open(e){this._isDropdownOpen!==e&&(e?this._showDropdown({userTriggered:!1}):this._closeDropdown())}get beforeValueChange(){return this._beforeValueChange}set beforeValueChange(e){e!==this._beforeValueChange&&(this._beforeValueChange=e)}get popupElement(){return this._adapter.getPopupElement()}}const Ue=`<template>
  <slot></slot>
</template>
`,Ve=":host{display:block}:host([hidden]){display:none}";var He=Object.defineProperty,Ke=Object.getOwnPropertyDescriptor,d=(r,e,t,i)=>{for(var s=i>1?void 0:i?Ke(e,t):e,n=r.length-1,a;n>=0;n--)(a=r[n])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&He(e,t,s),s};let p=class extends A{static get observedAttributes(){return[...A.observedAttributes,o.attributes.MODE,o.attributes.MULTIPLE,o.attributes.DEBOUNCE,o.attributes.FILTER_ON_FOCUS,o.attributes.FILTER_FOCUS_FIRST,o.attributes.ALLOW_UNMATCHED,o.attributes.POPUP_TARGET,o.attributes.OPEN,o.attributes.MATCH_KEY,o.attributes.FILTER_TEXT]}constructor(){super(),Y.define([Q,Z,J]),P(this,Ue,Ve),this._core=new Re(new Ne(this))}connectedCallback(){this.querySelector(o.selectors.INPUT)?this._core.initialize():G(this,o.selectors.INPUT).then(()=>this._core.initialize())}disconnectedCallback(){this._core.destroy()}attributeChangedCallback(r,e,t){switch(super.attributeChangedCallback(r,e,t),r){case o.attributes.MODE:this.mode=t;break;case o.attributes.MULTIPLE:this.multiple=b(t);break;case o.attributes.DEBOUNCE:this.debounce=j(t);break;case o.attributes.FILTER_ON_FOCUS:this.filterOnFocus=b(t);break;case o.attributes.FILTER_FOCUS_FIRST:this.filterFocusFirst=b(t);break;case o.attributes.ALLOW_UNMATCHED:this.allowUnmatched=b(t);break;case o.attributes.POPUP_TARGET:this.popupTarget=t;break;case o.attributes.OPEN:this.open=b(t);break;case o.attributes.MATCH_KEY:this.matchKey=t;break;case o.attributes.FILTER_TEXT:this.filterText=t;break}}appendOptions(r){this._core.appendOptions(r)}openDropdown(){this.open=!0}closeDropdown(){this.open=!1}forceFilter(r={preserveValue:!1}){this._core.forceFilter(r)}};d([h()],p.prototype,"mode",2);d([h()],p.prototype,"multiple",2);d([h()],p.prototype,"value",2);d([h()],p.prototype,"debounce",2);d([h()],p.prototype,"filterOnFocus",2);d([h()],p.prototype,"filterFocusFirst",2);d([h()],p.prototype,"allowUnmatched",2);d([h()],p.prototype,"popupTarget",2);d([h()],p.prototype,"filterText",2);d([h()],p.prototype,"optionBuilder",2);d([h()],p.prototype,"filter",2);d([h()],p.prototype,"selectedTextBuilder",2);d([h()],p.prototype,"open",2);d([h()],p.prototype,"matchKey",2);d([h({set:!1})],p.prototype,"isInitialized",2);d([h({set:!1})],p.prototype,"popupElement",2);d([h()],p.prototype,"beforeValueChange",2);p=d([B({name:o.elementName,dependencies:[he,oe,ie,se,ee,re,te,X]})],p);
