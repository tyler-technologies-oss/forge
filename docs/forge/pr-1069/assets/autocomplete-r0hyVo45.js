import{C as N,l as v,j as R,k as M,K as z}from"./base-component-DX3NI00Q.js";import{c as h,B as W}from"./base-adapter-B0TZVCzP.js";import"./service-adapter-CffG5Lhq.js";import{t as U,p as V,c as m,q,u as $,j as u,D as S,C as A,l as G,P as B,n as j,z as X,b as Y}from"./feature-detection-eeAKFJs_.js";import{F as J,I as Q,J as Z,R as tt,S as et}from"./tyler-icons-B0WPf66k.js";import{D as it}from"./divider-DtS4IZ9-.js";import"./index-DTwfV0k0.js";import{a as st}from"./linear-progress-CsYLd0m5.js";import{L as nt,a as rt}from"./list-CoogCWRP.js";import{L as ot,a as k}from"./list-dropdown-aware-core-DBtmNcHQ.js";import{a as x,P as lt}from"./popover-zm7hjeEB.js";import{a as at}from"./skeleton-DllEP8un.js";import{B as pt,l as ht,a as dt,T as b,b as ct}from"./text-field-ByQIIUxH.js";import{F as f,a as _t,b as ut,B as mt}from"./base-field-Br5NrBI4.js";import"./focus-indicator-BUDKaCFA.js";import{L as ft}from"./label-BIL6v9gy.js";import"./button-PV3UPUps.js";import"./state-layer-u9rLNX9t.js";import"./button-toggle-group-6Pgmj0Bd.js";import"./checkbox-Di24v2pW.js";import"./icon-button-DdBWwuxf.js";import"./switch-BrPNI0aD.js";import{C as gt}from"./chip-set-Hd7Fa2C2.js";import{d as bt,s as P,o as Ot}from"./utils-DU-9AqTO.js";import{a as Et,c as wt}from"./list-dropdown-CDCcD0pB.js";import"./overlay-BhwPRyah.js";const C=`${N}chip-field`,H={ADD_ON_BLUR:"add-on-blur"},vt={...H},Lt={CONTAINER:".container",INPUT:"input",MEMBER_SLOT:"slot[name=member]",MEMBER:"[slot=member]"},yt={HAS_MEMBERS:"has-members"},Dt={MEMBER_ADDED:`${C}-member-added`,MEMBER_REMOVED:`${C}-member-removed`},Tt=["disabled","placeholder"],Ct={LABEL:"LABEL"},c={elementName:C,observedAttributes:H,attributes:vt,selectors:Lt,classes:yt,events:Dt,observedInputAttributes:Tt,tagNames:Ct};class Ft extends pt{get hasValue(){return!!this._component.querySelector(c.selectors.MEMBER)||this.hasInputValue}get hasPlaceholder(){return!!this._inputElement?.placeholder}get hasInputValue(){return!!this._inputElement?.value}get inputHasFocus(){return!!this._inputElement?.matches(":focus")}get inputElement(){return this._inputElement}get popoverTargetElement(){return this._popoverTargetElement||(this._popoverTargetElement=v(this._fieldElement,f.selectors.POPOVER_TARGET)),this._popoverTargetElement}constructor(t){super(t),this._fieldElement=v(t,f.elementName),this._containerElement=v(t,c.selectors.CONTAINER),this._memberSlot=v(t,c.selectors.MEMBER_SLOT),this._fieldElement.setAttribute("exportparts",Object.values(f.parts).join(", "))}initialize(){this._inputElement=this._component.querySelector("input:not([type=checkbox]):not([type=radio])")}addRootListener(t,e,i){this._fieldElement.addEventListener(t,e,i)}removeRootListener(t,e,i){this._fieldElement.removeEventListener(t,e,i)}addInputListener(t,e){this._inputElement?.addEventListener(t,e)}removeInputListener(t,e){this._inputElement?.removeEventListener(t,e)}clickInput(){this._inputElement?.click()}tryAddValueChangeListener(t,e){this._destroyValueChangerListener?.(),this._inputElement&&(this._destroyValueChangerListener=ht(t,this._inputElement,"value",e))}removeValueChangeListener(){this._destroyValueChangerListener?.()}focusInput(){this._inputElement?.focus()}getSlottedMemberElements(){return this._memberSlot.assignedElements()}click(){this.focusInput()}applyLabel(t){this._inputElement&&U(this._inputElement,!!t,"aria-label",t??"")}tryFloatLabel(t){if(t!==void 0){this._component.floatLabel=t;return}this._component.floatLabel=this.hasValue||this.hasPlaceholder}handleDefaultSlotChange(t,e){this._inputMutationObserver?.disconnect();const i=t.assignedElements();this._inputElement=i.find(s=>s.matches(c.selectors.INPUT)),this._inputElement&&(this._component.disabled&&(this._inputElement.disabled=!0),this._inputMutationObserver=new MutationObserver(s=>{s.forEach(n=>{if(n.attributeName){const _=n.target.getAttribute(n.attributeName),a=n.attributeName;e(a,_)}})}),this._inputMutationObserver?.observe(this._inputElement,{attributes:!0,attributeFilter:[...c.observedInputAttributes]}),Object.values(c.observedInputAttributes).forEach(s=>{const n=s;this._inputElement&&e(n,this._inputElement.getAttribute(n))}))}tryConnectSlottedLabel(t){if(!this._inputElement)return;const e=t.assignedElements({flatten:!0}),i=e.find(l=>l.matches(ft.elementName));if(i){i.forElement=this._component,i.clickTarget=this._inputElement;return}const s=e.find(l=>l.tagName===c.tagNames.LABEL);if(!s||s.control)return;const n=this._inputElement.id||`forge-input-${V()}`;this._inputElement.id=n,s.htmlFor=n}toggleContainerClass(t,e){this._containerElement.classList.toggle(t,e)}setDisabled(t){this._inputElement&&(this._inputElement.disabled=t)}}class It extends dt{constructor(t){super(t),this._addOnBlur=!1,this._mouseDownListener=this._onMouseDown.bind(this),this._clickListener=this._onClick.bind(this),this._rootKeyDownListener=this._onRootKeyDown.bind(this),this._inputKeyDownListener=this._onKeyDown.bind(this),this._slotChangeListener=this._onSlotChange.bind(this),this._inputAttributeListener=this._onInputAttributeChange.bind(this),this._valueChangeListener=this._onValueChange.bind(this),this._inputListener=this._onValueChange.bind(this),this._blurListener=this._onBlur.bind(this)}initialize(){this._adapter.initialize(),this._adapter.addRootListener("mousedown",this._mouseDownListener,{capture:!0}),this._adapter.addRootListener("click",this._clickListener),this._adapter.addRootListener("keydown",this._rootKeyDownListener),this._adapter.addInputListener("keydown",this._inputKeyDownListener),this._adapter.addRootListener("slotchange",this._slotChangeListener),this._adapter.addRootListener("input",this._inputListener),this._adapter.tryAddValueChangeListener(this,this._valueChangeListener),this._addOnBlur&&this._adapter.addInputListener("blur",this._blurListener)}destroy(){this._adapter.removeRootListener("mousedown",this._mouseDownListener,{capture:!0}),this._adapter.removeRootListener("click",this._clickListener),this._adapter.removeRootListener("keydown",this._rootKeyDownListener),this._adapter.removeInputListener("keydown",this._inputKeyDownListener),this._adapter.removeRootListener("slotchange",this._slotChangeListener),this._adapter.removeRootListener("input",this._inputListener),this._adapter.removeInputListener("blur",this._blurListener),this._adapter.removeValueChangeListener()}_onBlur(t){const e=t.target;this._addOnBlur&&this._addMember(e),e.value=""}_onMouseDown(t){if(this._disabled||this._adapter.inputHasFocus){t.preventDefault(),t.stopPropagation();return}}_onClick(t){this._disabled||t.target!==this._adapter.inputElement&&(this._adapter.focusInput(),this._adapter.clickInput())}_onValueChange(){this._tryFloatLabel()}_onSlotChange(t){const e=t.target;switch(e.name){case"label":this._adapter.tryConnectSlottedLabel(e);break;case"member":this._adapter.toggleContainerClass(c.classes.HAS_MEMBERS,e.assignedElements().length>0),this._adapter.tryFloatLabel(),this._adapter.getSlottedMemberElements().forEach(i=>i.tabIndex=-1);break;case"":this._adapter.handleDefaultSlotChange(e,this._inputAttributeListener),this._adapter.tryAddValueChangeListener(this,this._valueChangeListener),this._tryFloatLabel();break}}_onInputAttributeChange(t,e){switch(t){case"disabled":this.disabled=e!==null;break;case"placeholder":this._tryFloatLabel();break}}_onRootKeyDown({key:t}){if(!this._adapter.hasInputValue)switch(t){case"ArrowRight":this._focusNextMember();break;case"ArrowLeft":this._focusPreviousMember();break;case"Backspace":case"Delete":this._removeMember();break}}_onKeyDown({target:t,key:e}){const i=t;switch(e){case"Enter":this._addMember(i);break;case"Escape":i.value="";break;case"Tab":this._addOnBlur||(i.value="");break}}_focusNextMember(){const t=this._adapter.getSlottedMemberElements();if(!(!t.length||this._adapter.inputHasFocus))for(let e=0;e<t.length;e++){const i=t.at(e),s=t.at(e+1);if(i&&this._isMemberActive(i))if(s){s.focus();break}else this._adapter.focusInput()}}_focusPreviousMember(){const t=this._adapter.getSlottedMemberElements();if(t.length){if(this._adapter.inputHasFocus){t[t.length-1].focus();return}for(let e=0;e<t.length;e++){const i=t.at(e-1),s=t.at(e);if(s&&this._isMemberActive(s)&&i){i.focus();break}}}}_isMemberActive(t){return t.matches(":focus-within")}_getActiveMember(){return this._adapter.getSlottedMemberElements().find(e=>this._isMemberActive(e))??null}_addMember(t){const e=t.value.trim();e.length>0&&this._adapter.emitHostEvent(c.events.MEMBER_ADDED,e),t.value=""}_removeMember(){let t=this._getActiveMember();t||(t=this._adapter.getSlottedMemberElements().at(-1)),t&&(this._focusNextMember(),this._adapter.emitHostEvent(c.events.MEMBER_REMOVED,t))}get addOnBlur(){return this._addOnBlur}set addOnBlur(t){t=!!t,this._addOnBlur!==t&&(this._addOnBlur=t,this._adapter.isConnected&&(this._addOnBlur?this._adapter.addInputListener("blur",this._blurListener):this._adapter.removeInputListener("blur",this._blurListener)),this._adapter.toggleHostAttribute(c.attributes.ADD_ON_BLUR,this._addOnBlur))}get popoverTargetElement(){return this._adapter.popoverTargetElement}get disabled(){return super.disabled}set disabled(t){this.disabled!==t&&(super.disabled=t,this._adapter.setDisabled(t))}}const St=`<template>
  <forge-field id="field" multiline>
    <slot slot="label" name="label"></slot>
    <slot slot="start" name="start"></slot>
    <div class="container" data-forge-field-input>
      <slot name="member"></slot>
      <slot></slot>
    </div>
    <slot slot="end" name="end"></slot>
    <slot slot="accessory" name="accessory"></slot>
    <slot slot="support-text" name="support-text"></slot>
    <slot slot="support-text-end" name="support-text-end"></slot>

    <!-- Include deprecated leading alias -->
    <slot slot="start" name="leading"></slot>
    <!-- Include deprecated trailing alias -->
    <slot slot="end" name="trailing"></slot>
    <!-- Include deprecated addon-end alias -->
    <slot slot="accessory" name="addon-end"></slot>
    <!-- Include deprecated helper-text alias -->
    <slot slot="support-text" name="helper-text"></slot>
  </forge-field>
</template>
`,At="@keyframes float-in-label-animation{0%{translate:0;opacity:40%}to{translate:var(--_field-floating-label-translation);opacity:100%}}@keyframes float-out-label-animation{0%{translate:var(--_field-floating-label-translation);opacity:40%}to{translate:0;opacity:100%}}@keyframes multiline-inset-label-background-animation{0%{opacity:0%}to{opacity:100%}}:host{display:block}:host([hidden]){display:none}forge-field{--_chip-field-member-spacing: var(--forge-chip-field-member-spacing, var(--forge-spacing-xsmall, 8px));--_chip-field-content-spacing: var(--forge-chip-field-content-spacing, var(--forge-spacing-xxsmall, 4px))}.container{display:flex;flex-wrap:wrap;align-items:center;gap:var(--_chip-field-member-spacing);block-size:auto}.container.has-members{margin-block:var(--_chip-field-content-spacing)}.container.has-members ::slotted(input){block-size:auto;inline-size:auto}::slotted(input){flex-grow:1;cursor:inherit;box-sizing:border-box;margin:0;outline:none;border:none;background-color:transparent;padding-block:0;padding-inline:0;inline-size:100%;block-size:100%;color:inherit;font:inherit;font-size:var(--_field-font-size);text-overflow:ellipsis;padding-block-start:0;padding-block-end:0;transition:padding-block var(--_field-floating-animation-duration) var(--_field-floating-animation-timing)}forge-field{display:contents;--forge-field-multiline-resize: none}forge-field::part(label):after{content:none}:host([theme=primary]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-primary, #3f51b5);--forge-chip-field-color: var(--forge-theme-on-primary, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-primary, #3f51b5)}:host([theme=secondary]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-secondary, #ffc107);--forge-chip-field-color: var(--forge-theme-on-secondary, #000000);--forge-chip-focus-indicator-color: var(--forge-theme-secondary, #ffc107)}:host([theme=tertiary]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-tertiary, #3d5afe);--forge-chip-field-color: var(--forge-theme-on-tertiary, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-tertiary, #3d5afe)}:host([theme=success]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-success, #2e7d32);--forge-chip-field-color: var(--forge-theme-on-success, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-success, #2e7d32)}:host([theme=warning]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-warning, #d14900);--forge-chip-field-color: var(--forge-theme-on-warning, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-warning, #d14900)}:host([theme=error]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-error, #b00020);--forge-chip-field-color: var(--forge-theme-on-error, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-error, #b00020)}:host([theme=info]) ::slotted([slot=member]){--forge-chip-field-background: var(--forge-theme-info, #1565c0);--forge-chip-field-color: var(--forge-theme-on-info, #ffffff);--forge-chip-focus-indicator-color: var(--forge-theme-info, #1565c0)}";var Bt=Object.defineProperty,kt=Object.getOwnPropertyDescriptor,K=(o,t,e,i)=>{for(var s=i>1?void 0:i?kt(t,e):t,n=o.length-1,l;n>=0;n--)(l=o[n])&&(s=(i?l(t,e,s):l(s))||s);return i&&s&&Bt(t,e,s),s};let F=class extends ut{static get observedAttributes(){return[...Object.values(mt.observedAttributes),...Object.values(c.observedAttributes)]}constructor(){super(),M(this,St,At),this._core=new It(new Ft(this))}connectedCallback(){this._core.initialize()}disconnectedCallback(){this._core.destroy()}attributeChangedCallback(o,t,e){if(super.attributeChangedCallback(o,t,e),o===c.attributes.ADD_ON_BLUR){this.addOnBlur=m(e);return}}get popoverTargetElement(){return this._core.popoverTargetElement}click(){this._core.click()}};K([h()],F.prototype,"addOnBlur",2);F=K([R({name:c.elementName,dependencies:[_t,gt]})],F);const D=`${N}autocomplete`,xt={MODE:"mode",MULTIPLE:"multiple",DEBOUNCE:"debounce",FILTER_ON_FOCUS:"filter-on-focus",FILTER_FOCUS_FIRST:"filter-focus-first",SELECT_FIRST_OPTION_ON_BLUR:"select-first-option-on-blur",ALLOW_UNMATCHED:"allow-unmatched",POPUP_TARGET:"popup-target",OPEN:"open",MATCH_KEY:"match-key",FILTER_TEXT:"filter-text"},Pt={INPUT:"input",DROPDOWN_ICON:"[data-forge-dropdown-icon],[data-forge-dropdown-icon],[forge-dropdown-icon],.forge-dropdown-icon",CLEAR_BUTTON:"[data-forge-autocomplete-clear],[forge-autocomplete-clear]"},Nt={DEFAULT_DEBOUNCE_TIME:z},Rt={CHANGE:`${D}-change`,SELECT:`${D}-select`,SCROLLED_BOTTOM:`${D}-scrolled-bottom`},r={elementName:D,attributes:xt,selectors:Pt,numbers:Nt,events:Rt};var O=(o=>(o.Default="default",o.Stateless="stateless",o))(O||{});class Mt extends W{constructor(t){super(t),this.setInputElement()}get inputElement(){return this._inputElement}setInputElement(){const t=q(this._component,r.selectors.INPUT,!1);return t.length&&(this._inputElement=t[0]),this._inputElement}setInputAttribute(t,e){this._inputElement.setAttribute(t,e)}addInputListener(t,e){this._inputElement.addEventListener(t,e)}removeInputListener(t,e){this._inputElement.removeEventListener(t,e)}initializeInputAccessibility(t){this._inputElement.setAttribute("autocomplete","off"),this._inputElement.setAttribute("role","combobox"),this._inputElement.setAttribute("aria-live","polite"),this._inputElement.setAttribute("aria-atomic","true"),this._inputElement.setAttribute("aria-haspopup","true"),this._inputElement.setAttribute("aria-expanded","false"),this._inputElement.setAttribute("aria-autocomplete","list"),bt(),P(this._inputElement)}isWrappingChipField(){return!!this._component.querySelector(c.elementName)}show(t,e){this._targetElement=this._getTargetElement(e),this._targetElement&&(this._listDropdown=new Et(this._targetElement,t),this._listDropdown.open(),this._inputElement.setAttribute("aria-expanded","true"),this._inputElement.setAttribute("aria-controls",`list-dropdown-popup-${t.id}`),this._tryToggleDropdownIconRotation(!0))}async hide(t,{destroy:e=!1}={}){if(this.setBusyVisibility(!1),this._tryToggleDropdownIconRotation(!1),this._inputElement?.removeAttribute("aria-activedescendant"),this._inputElement?.setAttribute("aria-expanded","false"),P(this._inputElement),!this._listDropdown)return;const{anchorElement:i}=this._listDropdown.dropdownElement;i&&i instanceof HTMLElement&&i?.removeEventListener(x.events.TOGGLE,t),e?this._listDropdown.destroy():await this._listDropdown.close(),this._listDropdown=void 0}setBusyVisibility(t){this._listDropdown?.setBusyVisibility(t)}setDismissListener(t){this._listDropdown?.dropdownElement?.addEventListener(x.events.TOGGLE,t)}focus(){window.requestAnimationFrame(()=>this._inputElement.focus())}setOptions(t){this._listDropdown?.setOptions(t)}appendOptions(t){this._listDropdown?.appendOptions(t)}setSelectedText(t){this._inputElement.value=t}getInputValue(){return this._inputElement.value}setInputValue(t){this._inputElement.value=t}selectInputValue(){window.requestAnimationFrame(()=>this._inputElement.select())}isFocusWithinPopup(t){return!this._listDropdown||!this._listDropdown.dropdownElement?!1:this._listDropdown.dropdownElement.contains(t)}hasFocus(){const t=$(this._component.ownerDocument);return t===this._inputElement||this.isFocusWithinPopup(t)}hasInputElement(){return!!this._inputElement}setDropdownIconListener(t,e){window.requestAnimationFrame(()=>{const i=this._component.querySelector(b.elementName);if(i&&(i.popoverIcon||i.hasAttribute(f.attributes.POPOVER_ICON))){const n=t==="mousedown"?f.events.POPOVER_ICON_MOUSEDOWN:f.events.POPOVER_ICON_CLICK;this._component.addEventListener(n,e)}this._component.querySelector(r.selectors.DROPDOWN_ICON)?.addEventListener(t,e)})}removeDropdownIconListener(t,e){this._component.removeEventListener(f.events.POPOVER_ICON_CLICK,e),this._component.querySelector(r.selectors.DROPDOWN_ICON)?.removeEventListener(t,e)}setClearButtonListener(t,e){window.requestAnimationFrame(()=>{const i=this._component.querySelector(b.elementName);i&&(i.showClear||i.hasAttribute(b.attributes.SHOW_CLEAR))&&this._component.addEventListener(b.events.CLEAR,e);const s=this._component.querySelector(r.selectors.CLEAR_BUTTON);s&&s.addEventListener(t,e)})}removeClearButtonListener(t,e){this._component.removeEventListener(b.events.CLEAR,e),this._component.querySelector(r.selectors.CLEAR_BUTTON)?.removeEventListener(t,e)}propagateKey(t){this._listDropdown?.handleKey(t)}updateActiveDescendant(t){this._targetElement&&U(this._inputElement,!!t,"aria-activedescendant",t)}getTargetElementWidth(t){return this._targetElement||(this._targetElement=this._getTargetElement(t)),this._targetElement.getBoundingClientRect().width}getPopupElement(){return this._listDropdown?.dropdownElement??null}activateFirstOption(){this._listDropdown?.activateFirstOption()}activateSelectedOption(){this._listDropdown?.activateSelectedOption()}activateOptionByIndex(t){this._listDropdown?.activateOption(t)}getActiveOptionIndex(){return this._listDropdown?.getActiveOptionIndex()??null}clearActiveOption(){this._listDropdown?.clearActiveOption()}setSelectedOptions(t){if(this._listDropdown){const e=t.map(i=>i.value);this._listDropdown.setSelectedValues(e)}}queueDropdownPositionUpdate(){this.getPopupElement()&&window.requestAnimationFrame(()=>{this.getPopupElement()?.position()})}_getTargetElement(t){return t?this._component.querySelector(t)||this._getDefaultTargetElement():this._getDefaultTargetElement()}_getDefaultTargetElement(){const t=this._tryGetFieldLikeChild();return t?.popoverTargetElement?t.popoverTargetElement:this._component.querySelector("input")||this._component}_tryToggleDropdownIconRotation(t){const e=this._tryGetFieldLikeChild();e?.popoverIcon&&(e.popoverExpanded=t);const i=this._component.querySelector(r.selectors.DROPDOWN_ICON);i&&(i.style.transition="transform 120ms linear",i.style.transform=t?"rotateZ(180deg)":"")}_tryGetFieldLikeChild(){const t=[b.elementName,c.elementName];return this._component.querySelector(`:is(${t.join(",")})`)}}var E=(o=>(o[o.Option=0]="Option",o[o.Group=1]="Group",o))(E||{});function L(o,t){const e=(n,l)=>Object.prototype.hasOwnProperty.call(n,l),i=o.some(n=>u(n)&&S(n)&&e(n,"options")&&(e(n,"text")||e(n,"builder"))),s=o.some(n=>u(n)&&S(n)&&e(n,"label")&&e(n,"value"));return i&&t===1||s&&t===0}function Ut(o,t){return o.find(e=>e.value===t)}function y(o,t,e=null){return e?!(e in o.value)||!(e in t)?!1:A(o.value[e],t[e]):A(o.value,t)}class Vt extends ot{constructor(t){super(),this._adapter=t,this._isInitialized=!1,this._isDropdownOpen=!1,this._mode=O.Default,this._multiple=!1,this._debounce=r.numbers.DEFAULT_DEBOUNCE_TIME,this._allowUnmatched=!1,this._filterOnFocus=!0,this._filterFocusFirst=!0,this._selectFirstOptionOnBlur=!1,this._options=[],this._filterText="",this._selectedOptions=[],this._values=[],this._pendingFilterPromises=[],this._selectOnBlurPending=!1,this._matchKey=null,this._clickListener=e=>this._onClick(e),this._focusListener=()=>this._onFocus(),this._blurListener=e=>this._onBlur(e),this._keydownListener=e=>this._onKeydown(e),this._dropdownIconClickListener=e=>this._onDropdownIconClick(e),this._dropdownScrollEndListener=()=>this._onDropdownScrollEnd(),this._dropdownIconMouseDownListener=e=>this._onDropdownIconMouseDown(e),this._clearButtonListener=e=>this._onClear(e),this._dismissListener=()=>this._onDismiss(),this._activeChangeListener=e=>this._adapter.updateActiveDescendant(e),this._targetWidthCallback=()=>this._adapter.getTargetElementWidth(this._popupTarget),this._identifier=V()}async initialize(){if(!this._adapter.hasInputElement()&&!this._adapter.setInputElement())throw new Error("An input element is required as a child of the autocomplete component.");if(this._setInputListener(),this._setFilterCallback(),this._attachListeners(),this._initializeAccessibility(),this._values.length){if(!this._selectedOptions.length){try{await this._executeFilter()}catch(t){console.error(t)}this._updateSelectedOptions(this._values)}this._adapter.setSelectedText(this._getSelectedText())}this._isInitialized=!0}destroy(){this._isInitialized&&(this._detachListeners(),this._isInitialized=!1),this._closeDropdown({destroy:!0})}async forceFilter({preserveValue:t}){this._options=[],await this._executeFilter(!0,!0),t&&this._options.push(...this._selectedOptions),this._applyValue(this._values)}_attachListeners(){this._adapter.addInputListener("click",this._clickListener),this._adapter.addInputListener("focus",this._focusListener),this._adapter.addInputListener("blur",this._blurListener),this._adapter.addInputListener("input",this._inputListener),this._adapter.addInputListener("keydown",this._keydownListener),this._adapter.setDropdownIconListener("click",this._dropdownIconClickListener),this._adapter.setDropdownIconListener("mousedown",this._dropdownIconMouseDownListener),this._adapter.setClearButtonListener("click",this._clearButtonListener)}_detachListeners(){this._adapter.removeInputListener("click",this._clickListener),this._adapter.removeInputListener("focus",this._focusListener),this._adapter.removeInputListener("blur",this._blurListener),this._adapter.removeInputListener("input",this._inputListener),this._adapter.removeInputListener("keydown",this._keydownListener),this._adapter.removeDropdownIconListener("click",this._dropdownIconClickListener),this._adapter.removeDropdownIconListener("mousedown",this._dropdownIconMouseDownListener),this._adapter.removeClearButtonListener("click",this._clearButtonListener)}_setInputListener(){this._inputListener=t=>this._onInput(t)}_setFilterCallback(){this._filterFn=u(this._debounce)&&this._debounce>0?G(this._debounceFilter,this._debounce,!1):this._debounceFilter}_initializeAccessibility(){this._adapter.initializeInputAccessibility(this._identifier)}get _flatOptions(){return L(this._options,E.Group)?this._options.reduce((t,e)=>t.concat(e.options),[]):this._options}_onClick(t){!this._isDropdownOpen&&this._filterOnFocus?this._showDropdown():this._closeDropdown()}_onDropdownIconMouseDown(t){t.preventDefault()}_onDropdownIconClick(t){this._isDropdownOpen?this._closeDropdown():(this._adapter.focus(),window.requestAnimationFrame(()=>this._showDropdown()))}_onClear(t){t.preventDefault(),this._filterText="",this._clearValue(),this._adapter.setSelectedText(this._getSelectedText())}_onDropdownScrollEnd(){this._adapter.emitHostEvent(r.events.SCROLLED_BOTTOM)}_onFocus(){this._selectOnBlurPending=!1,!this._isDropdownOpen&&this._adapter.getInputValue()&&!B.isMobile&&this._adapter.selectInputValue()}_onBlur(t){this._adapter.isFocusWithinPopup(t.relatedTarget)||this._applyBlur()}_applyBlur(){this._selectOnBlurPending=this._shouldSelectFirstOptionOnBlur(),this._isDropdownOpen&&this._closeDropdown(),!(this._selectOnBlurPending||this._mode===O.Stateless)&&(this._selectedOptions.length?this._adapter.setSelectedText(this._getSelectedText()):this._allowUnmatched||(this._filterText="",this._adapter.setSelectedText("")))}_shouldSelectFirstOptionOnBlur(){return this._selectFirstOptionOnBlur&&!this._multiple&&this._mode!==O.Stateless&&!!this._filter&&!!this._filterText}_onInput(t){this._selectedOptions.length&&!this._multiple&&(!this._adapter.getInputValue()||this._allowUnmatched)&&!this._adapter.isWrappingChipField()&&(this._selectedOptions=[],this._values=[],this._emitChangeEvent()),this._filterText=this._adapter.getInputValue(),this._filterFn()}async _debounceFilter({checkFocus:t=!0}={}){if(!t&&!this._adapter.hasFocus()){this._pendingFilterPromises=[],this._isDropdownOpen&&this._closeDropdown();return}const e=this._filterText,i=this._executeFilter();this._pendingFilterPromises.push(i);const s=this._selectOnBlurPending&&!this._adapter.hasFocus();this._isDropdownOpen&&s?this._closeDropdown():this._isDropdownOpen?this._adapter.setBusyVisibility(!0):s||this._showDropdown({filter:!1});try{await i}catch{this._pendingFilterPromises=[],this._selectOnBlurPending=!1,this._isDropdownOpen&&this._closeDropdown();return}if(e===this._filterText)this._pendingFilterPromises=[],this._onFilterComplete();else{const n=this._pendingFilterPromises.indexOf(i);n!==-1&&this._pendingFilterPromises.splice(n,1)}}_onKeydown(t){switch(t.key){case"Tab":this._isDropdownOpen&&!this._multiple&&this._selectActiveOption(!1);break;case"Esc":case"Escape":this._isDropdownOpen&&(t.preventDefault(),t.stopPropagation(),this._closeDropdown());break;case"Down":case"ArrowDown":t.preventDefault(),this._isDropdownOpen?this._adapter.propagateKey(t.key):this._showDropdown({activateFirst:!0,activateSelected:!0});break;case"Up":case"ArrowUp":t.preventDefault(),this._isDropdownOpen&&this._adapter.propagateKey(t.key);break;case"Enter":case"Home":case"End":this._isDropdownOpen&&(t.key==="Enter"&&t.stopPropagation(),t.preventDefault(),this._adapter.propagateKey(t.key));break;case"Backspace":case"Delete":{const e=t.target,i=this._adapter.getInputValue(),s=e.value.substring(e.selectionStart,e.selectionEnd)===e.value,n=i.length===1&&e.selectionEnd===1,l=i.length===1&&e.selectionEnd===0,_=!i||s||n||l;!this._adapter.isWrappingChipField()&&_&&!this._multiple&&this._values.length&&this._clearValue();break}}}_executeFilter(t=!0,e=!1){if(!this._filter||typeof this._filter!="function")throw new Error('A filter callback must be provided. Did you set the "filter" property?');const i=this._filter,s=t?this._filterText:"",n=e?this._getValue():null;return new Promise((l,_)=>Promise.resolve(i(s,n)).then(a=>{this._options=a,l(this._options)}).catch(a=>_(`An unexpected error occurred while filtering: ${a}`)))}_onFilterComplete(){const t=this._selectFirstOptionOnBlur&&this._selectOnBlurPending;if(!this._options.length){this._selectOnBlurPending=!1,this._isDropdownOpen&&this._closeDropdown(),t&&!this._allowUnmatched&&(this._filterText="",this._adapter.setSelectedText(""),this._clearValue());return}if(t){this._selectOnBlurPending=!1;const i=this._flatOptions[0];i&&this._onSelect(i.value,!1);return}if(!this._adapter.hasFocus()){this._selectOnBlurPending=!1,this._isDropdownOpen&&this._closeDropdown();return}const e=this._allowUnmatched&&!this._selectedOptions.length;this._dropdownReady({userTriggered:e}),this._filterFocusFirst&&this._filterText&&this._adapter.activateFirstOption()}_clearValue(){this._selectedOptions=[],this._values=[],this._isDropdownOpen&&(this._adapter.setSelectedOptions([]),this._adapter.clearActiveOption()),this._emitChangeEvent()}async _showDropdown({filter:t=!0,userTriggered:e=!0,activateFirst:i=!1,activateSelected:s=!1}={}){if(!this._isInitialized||!this._adapter.hasInputElement())return;const n=this._allowUnmatched&&!this._selectedOptions.length;this._isDropdownOpen=!0;let l;if(this._optionBuilder){const a=this._optionBuilder;l=(w,T)=>a(w,this._filterText,T)}const _={options:this._options,referenceElement:this._adapter.inputElement,multiple:this._multiple,selectedValues:[...this._values],id:`forge-autocomplete-${this._identifier}`,asyncStyle:wt.Skeleton,headerBuilder:this._popupHeaderBuilder,footerBuilder:this._popupFooterBuilder,transform:(a,w,T)=>{const I=this._adapter.getInputValue();if(this._filterText&&I?.length&&I!==a&&this._adapter.hasFocus()){const g=Ot(a,this._filterText);if(g)return g}else if(T){const g=document.createElement("span");return g.style.fontWeight="bold",g.textContent=a,g}return a},allowBusy:!0,optionBuilder:l,optionLimit:this._optionLimit,popupClasses:this._popupClasses,syncWidth:this._syncPopupWidth,constrainViewportWidth:this._constrainPopupWidth,wrapOptionText:this._wrapOptionText,observeScroll:this._observeScroll,observeScrollThreshold:this._observeScrollThreshold,popupPlacement:this._popoverPlacement,popupOffset:this._popoverOffset,popupFlip:this._popoverFlip,popupShift:this._popoverShift,popupFallbackPlacements:this._popoverFallbackPlacements,scrollEndListener:this._dropdownScrollEndListener,activeChangeCallback:this._activeChangeListener,targetWidthCallback:this._targetWidthCallback,selectCallback:a=>this._onSelect(a),closeCallback:()=>this._closeDropdown()};if(this._adapter.show(_,this._popupTarget),this._adapter.toggleHostAttribute(r.attributes.OPEN,this._isDropdownOpen),t){this._options.length&&this._adapter.setBusyVisibility(!0);try{await this._executeFilter(n)}catch(a){console.error(a)}this._updateSelectedOptions(this._values)}this._pendingFilterPromises.length||this._dropdownReady({userTriggered:e,activateFirst:i,activateSelected:s})}_dropdownReady({userTriggered:t=!0,activateFirst:e=!1,activateSelected:i=!1}={}){if(!this._isDropdownOpen||!this._options.length||t&&!this._adapter.hasFocus()){this._closeDropdown();return}this._sortSelectedOptions(),this._adapter.setBusyVisibility(!1),this._adapter.setOptions(this._options),this._adapter.setSelectedOptions(this._selectedOptions),this._adapter.setDismissListener(this._dismissListener),i&&this._selectedOptions.length?this._adapter.activateSelectedOption():e&&this._adapter.activateFirstOption()}_closeDropdown({destroy:t=!1}={}){this._multiple&&(this._filterText=""),this._isDropdownOpen=!1,this._adapter.hide(this._dismissListener,{destroy:t}),this._sortSelectedOptions(),this._adapter.toggleHostAttribute(r.attributes.OPEN,this._isDropdownOpen)}_sortSelectedOptions(){if(this._multiple&&this._selectedOptions.length&&L(this._options,E.Option)){const t=[],e=[];this._options.forEach(i=>{this._selectedOptions.find(s=>y(s,i.value,this._matchKey))?t.push(i):e.push(i)}),this._options=[...t,...e]}}async _onSelect(t,e=!0){if(this._valueChanging)return;if(this._mode===O.Stateless){const s={value:t};this._adapter.emitHostEvent(r.events.SELECT,s,!0,!0)&&(this._filterText="",this._multiple||this._closeDropdown());return}const i=()=>{const n=this._flatOptions.find(a=>y(a,t,this._matchKey)),l=n?n.value:"",_=n?n.label:"";if(this._multiple){const a=Ut(this._selectedOptions,l);if(a){const w=this._selectedOptions.indexOf(a);this._selectedOptions.splice(w,1)}else this._selectedOptions.push(n)}else u(l)?(this._selectedOptions[0]=n,this._filterText=_):(this._selectedOptions=[],this._filterText="");this._isDropdownOpen&&this._adapter.setSelectedOptions(this._selectedOptions),this._values=this._selectedOptions.map(a=>a.value),this._adapter.setSelectedText(this._getSelectedText()),!B.isMobile&&e&&this._adapter.selectInputValue(),this._emitChangeEvent(),this._tryUpdateDropdownPosition()};this._isDropdownOpen&&!this._multiple&&this._closeDropdown(),typeof this._beforeValueChange=="function"?(this._valueChanging=Promise.resolve(this._beforeValueChange.call(null,t,this._matchKey)),await this._valueChanging?i():this._tryUpdateDropdownPosition(),this._valueChanging=void 0):i()}_selectActiveOption(t=!0){const e=this._adapter.getActiveOptionIndex();if(typeof e=="number"&&e>=0){const i=this._flatOptions[e];i&&this._onSelect(i.value,t)}}_emitChangeEvent(){this._adapter.emitHostEvent(r.events.CHANGE,this._getValue(),!0)}_tryUpdateDropdownPosition(){this._isDropdownOpen&&this._adapter.queueDropdownPositionUpdate()}_getValue(){return this._values?this._values.length?this._multiple?[...this._values]:this._values[0]:this._multiple?[]:null:null}_getSelectedText(){return this._adapter.isWrappingChipField()?"":this._selectedTextBuilder?this._selectedTextBuilder(this._selectedOptions):this._multiple?this._values.length?this._values.length===1?this._selectedOptions[0]?.label??"":`${this._values.length} options selected`:"":this._selectedOptions.filter(t=>t&&t.label).map(t=>t.label).join(" ").trim()}_onDismiss(){this._closeDropdown()}async _applyValue(t){let e=[];this._selectedOptions=[],Array.isArray(t)?e=t:e=u(t)?[t]:[],!this._multiple&&e.length>1&&(e=[e[0]]),L(e,E.Option)?(this._values=e.map(s=>s.value),this._selectedOptions=e):this._values=e;const i=this._flatOptions;if(e.length&&i.length&&this._updateSelectedOptions(e),this._values.length&&!this._selectedOptions.length&&this._filter&&this._isInitialized){try{await this._executeFilter(!1,!0)}catch(s){console.error(s)}this._updateSelectedOptions(this._values)}this._multiple?this._filterText="":this._filterText=this._selectedOptions.length?this._selectedOptions[0].label:"",this._isInitialized&&this._adapter.setSelectedText(this._getSelectedText()),this._isDropdownOpen&&this._adapter.setSelectedOptions(this._selectedOptions)}_updateSelectedOptions(t){const e=[...this._flatOptions,...this._selectedOptions];if(this._selectedOptions.length&&(this._selectedOptions=[]),L(t,E.Option))for(const i of t){const s=e.find(n=>y(n,i.value,this._matchKey));s?this._selectedOptions.push(s):this._selectedOptions.push(i)}else for(const i of t){const s=e.find(n=>y(n,i,this._matchKey));s?this._selectedOptions.push(s):this._allowUnmatched&&this._selectedOptions.push({label:i,value:i})}}get mode(){return this._mode}set mode(t){this._mode!==t&&(this._mode=t,this._mode===O.Stateless&&(this._selectedOptions=[],this._isDropdownOpen&&this._closeDropdown()),this._adapter.setHostAttribute(r.attributes.MODE,this._mode))}get multiple(){return this._multiple}set multiple(t){this._multiple!==t&&(this._multiple=t,this._adapter.setHostAttribute(r.attributes.MULTIPLE,u(this._multiple)?this._multiple.toString():""))}get value(){return this._getValue()}set value(t){let e=[];t==null?e=[]:Array.isArray(t)?e=structuredClone(t):j(t)?e=[t]:e=[structuredClone(t)],(e.length!==this._values.length||e.some(s=>!this._values.includes(s)))&&this._applyValue(t)}get filterOnFocus(){return this._filterOnFocus}set filterOnFocus(t){this._filterOnFocus!==t&&(this._filterOnFocus=t,this._adapter.setHostAttribute(r.attributes.FILTER_ON_FOCUS,u(this._filterOnFocus)?this._filterOnFocus.toString():""))}get filterFocusFirst(){return this._filterFocusFirst}set filterFocusFirst(t){this._filterFocusFirst!==t&&(this._filterFocusFirst=t,this._adapter.toggleHostAttribute(r.attributes.FILTER_FOCUS_FIRST,this._filterFocusFirst))}get selectFirstOptionOnBlur(){return this._selectFirstOptionOnBlur}set selectFirstOptionOnBlur(t){this._selectFirstOptionOnBlur!==t&&(this._selectFirstOptionOnBlur=t,this._adapter.toggleHostAttribute(r.attributes.SELECT_FIRST_OPTION_ON_BLUR,this._selectFirstOptionOnBlur))}get allowUnmatched(){return this._allowUnmatched}set allowUnmatched(t){this._allowUnmatched!==t&&(this._allowUnmatched=t,u(this._allowUnmatched)&&this._adapter.setHostAttribute(r.attributes.ALLOW_UNMATCHED,this._allowUnmatched.toString()))}get matchKey(){return this._matchKey}set matchKey(t){this._matchKey!==t&&(this._matchKey=t)}get popupTarget(){return this._popupTarget}set popupTarget(t){this._popupTarget!==t&&(this._popupTarget=t)}get filterText(){return this._filterText}set filterText(t){this._filterText!==t&&(this._filterText=this._allowUnmatched?t:"",this._isInitialized&&this._allowUnmatched&&(this._adapter.setInputValue(this._filterText),this._isDropdownOpen&&this._debounceFilter({checkFocus:!1})))}get popupClasses(){return Array.isArray(this._popupClasses)?[...this._popupClasses]:[this._popupClasses]}set popupClasses(t){this._popupClasses!==t&&(this._popupClasses=Array.isArray(t)?[...t]:[t])}set popupHeaderBuilder(t){this._popupHeaderBuilder=t}set popupFooterBuilder(t){this._popupFooterBuilder=t}get syncPopupWidth(){return this._syncPopupWidth}set syncPopupWidth(t){this._syncPopupWidth!==t&&(this._syncPopupWidth=t)}get optionLimit(){return this._optionLimit}set optionLimit(t){this._optionLimit!==t&&(this._optionLimit=t)}get debounce(){return this._debounce}set debounce(t){this._debounce!==t&&(this._debounce=t,this._isInitialized&&this._setFilterCallback(),this._adapter.setHostAttribute(r.attributes.DEBOUNCE,u(this._debounce)?this._debounce.toString():""))}get optionBuilder(){return this._optionBuilder}set optionBuilder(t){this._optionBuilder=t}get filter(){return this._filter}set filter(t){this._filter!==t&&(this._filter=t,this._isInitialized&&this._values.length&&!this._flatOptions.length&&this._filter&&this._executeFilter().then(()=>{this._updateSelectedOptions(this._values),this._adapter.setSelectedText(this._getSelectedText())}))}get selectedTextBuilder(){return this._selectedTextBuilder}set selectedTextBuilder(t){this._selectedTextBuilder=t,this._selectedOptions.length&&this._adapter.setSelectedText(this._getSelectedText())}get observeScroll(){return this._observeScroll}set observeScroll(t){this._observeScroll=t}get observeScrollThreshold(){return this._observeScrollThreshold}set observeScrollThreshold(t){this._observeScrollThreshold=t}appendOptions(t){this._isDropdownOpen&&(this._options=[...this._options,...t],this._adapter.appendOptions(t))}get isInitialized(){return this._isInitialized}get open(){return this._isDropdownOpen}set open(t){this._isDropdownOpen!==t&&(t?this._showDropdown({userTriggered:!1}):this._closeDropdown())}get beforeValueChange(){return this._beforeValueChange}set beforeValueChange(t){t!==this._beforeValueChange&&(this._beforeValueChange=t)}get popupElement(){return this._adapter.getPopupElement()}}const Ht=`<template>
  <slot></slot>
</template>
`,Kt=":host{display:block}:host([hidden]){display:none}";var zt=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,d=(o,t,e,i)=>{for(var s=i>1?void 0:i?Wt(t,e):t,n=o.length-1,l;n>=0;n--)(l=o[n])&&(s=(i?l(t,e,s):l(s))||s);return i&&s&&zt(t,e,s),s};let p=class extends k{static get observedAttributes(){return[...k.observedAttributes,r.attributes.MODE,r.attributes.MULTIPLE,r.attributes.DEBOUNCE,r.attributes.FILTER_ON_FOCUS,r.attributes.FILTER_FOCUS_FIRST,r.attributes.SELECT_FIRST_OPTION_ON_BLUR,r.attributes.ALLOW_UNMATCHED,r.attributes.POPUP_TARGET,r.attributes.OPEN,r.attributes.MATCH_KEY,r.attributes.FILTER_TEXT]}constructor(){super(),Q.define([Z,tt,et]),M(this,Ht,Kt),this._core=new Vt(new Mt(this))}connectedCallback(){this.querySelector(r.selectors.INPUT)?this._core.initialize():X(this,r.selectors.INPUT).then(()=>this._core.initialize())}disconnectedCallback(){this._core.destroy()}attributeChangedCallback(o,t,e){switch(super.attributeChangedCallback(o,t,e),o){case r.attributes.MODE:this.mode=e;break;case r.attributes.MULTIPLE:this.multiple=m(e);break;case r.attributes.DEBOUNCE:this.debounce=Y(e);break;case r.attributes.FILTER_ON_FOCUS:this.filterOnFocus=m(e);break;case r.attributes.FILTER_FOCUS_FIRST:this.filterFocusFirst=m(e);break;case r.attributes.SELECT_FIRST_OPTION_ON_BLUR:this.selectFirstOptionOnBlur=m(e);break;case r.attributes.ALLOW_UNMATCHED:this.allowUnmatched=m(e);break;case r.attributes.POPUP_TARGET:this.popupTarget=e;break;case r.attributes.OPEN:this.open=m(e);break;case r.attributes.MATCH_KEY:this.matchKey=e;break;case r.attributes.FILTER_TEXT:this.filterText=e;break}}appendOptions(o){this._core.appendOptions(o)}openDropdown(){this.open=!0}closeDropdown(){this.open=!1}forceFilter(o={preserveValue:!1}){this._core.forceFilter(o)}};d([h()],p.prototype,"mode",2);d([h()],p.prototype,"multiple",2);d([h()],p.prototype,"value",2);d([h()],p.prototype,"debounce",2);d([h()],p.prototype,"filterOnFocus",2);d([h()],p.prototype,"filterFocusFirst",2);d([h()],p.prototype,"selectFirstOptionOnBlur",2);d([h()],p.prototype,"allowUnmatched",2);d([h()],p.prototype,"popupTarget",2);d([h()],p.prototype,"filterText",2);d([h()],p.prototype,"optionBuilder",2);d([h()],p.prototype,"filter",2);d([h()],p.prototype,"selectedTextBuilder",2);d([h()],p.prototype,"open",2);d([h()],p.prototype,"matchKey",2);d([h({set:!1})],p.prototype,"isInitialized",2);d([h({set:!1})],p.prototype,"popupElement",2);d([h()],p.prototype,"beforeValueChange",2);p=d([R({name:r.elementName,dependencies:[ct,lt,nt,rt,it,at,st,J]})],p);
