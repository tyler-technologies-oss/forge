@use '../../core/styles/spacing';
@use '../../core/styles/typography';
@use './token-utils' as *;

@forward './token-utils';

@mixin host {
  display: inline;
}

@mixin vertical-host {
  display: block;
}

@mixin base {
  box-sizing: border-box;
}

@mixin vertical-base {
  display: flex;
  flex-direction: row-reverse;
  align-items: end;
  block-size: 100%;
  inline-size: fit-content;
  max-inline-size: 100%;
}

@mixin heading {
  @include typography.style(label1);

  display: flex;
  align-items: center;
  justify-content: space-between;
  line-height: normal;
}

@mixin vertical-heading {
  flex-direction: column;
  align-items: start;
}

@mixin heading-with-content {
  margin-block-end: #{spacing.variable(xxsmall)};
}

@mixin vertical-heading-with-content {
  margin-block-end: 0;
  margin-inline-start: #{spacing.variable(xsmall)};
}

@mixin label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

@mixin value {
  color: var(--forge-theme-text-medium);
}

@mixin track {
  position: relative;
  block-size: #{token(height)};
  border-radius: #{token(shape)};
  overflow: hidden;
  background: #{token(background)};
}

@mixin vertical-track {
  inline-size: #{token(height)};
  block-size: 100%;
}

@mixin bar {
  position: absolute;
  inset-inline-start: -100%;
  block-size: 100%;
  inline-size: 100%;
  border-radius: #{token(inner-shape)};
  box-shadow: #{token(inner-elevation)};
  background: #{token(color)};
  translate: var(--_meter-percentage) 0;
}

@mixin vertical-bar {
  inset-inline-start: initial;
  inset-block-start: 100%;
  translate: 0 calc(-1 * var(--_meter-percentage));
}

@mixin theme($theme, $muted: false) {
  @include override(background, var(--forge-theme-#{$theme}-container-#{if($muted, 'minimum', 'low')}), value);
  @include override(color, var(--forge-theme-#{$theme}#{if($muted, '-container-high', '')}), value);
}

@mixin segmented($muted: false) {
  @include override(background, var(--forge-theme-warning-container-#{if($muted, 'minimum', 'low')}), value);
  @include override(color, var(--forge-theme-warning#{if($muted, '-container-high', '')}), value);
}

@mixin least-optimal($muted: false) {
  @include override(background, var(--forge-theme-error-container-#{if($muted, 'minimum', 'low')}), value);
  @include override(color, var(--forge-theme-error#{if($muted, '-container-high', '')}), value);
}

@mixin optimal($muted: false) {
  @include override(background, var(--forge-theme-success-container-#{if($muted, 'minimum', 'low')}), value);
  @include override(color, var(--forge-theme-success#{if($muted, '-container-high', '')}), value);
}

@mixin lowest {
  @include override(inner-elevation, 0, value);
}

@function tickmarks-background($count, $color, $secondary-color: null, $vertical: false) {
  $transparent-start: if($secondary-color, 2px, 1px);
  @return repeating-linear-gradient(
    if($vertical, 0, 90deg),
    $color 0px,
    $color 1px,
    if($secondary-color, #{$secondary-color} + ' 1px,', null) if($secondary-color, #{$secondary-color} + ' 2px,', null) transparent $transparent-start,
    transparent calc(100% / ($count + 1) + 0px)
  );
}

@mixin tickmarks {
  // We add an inline margin and offset the background to hide tickmarks right at the edge of the meter
  $background-offset: 2px;

  content: '';
  position: relative;
  display: block;
  block-size: 100%;
  inline-size: 100%;
  margin-inline-start: $background-offset;
  background: tickmarks-background(token(tickmarks), token(color), token(background));
  background-position-x: -$background-offset;
  opacity: #{token(tickmark-opacity)};
  pointer-events: none;
}

@mixin vertical-tickmarks {
  // Use a background offset same as the horizontal mixin but in the block direction
  $background-offset: 2px;

  margin-block-start: -$background-offset;
  margin-inline-start: 0;
  background: tickmarks-background(token(tickmarks), token(color), token(background), true);
  background-position-x: 0;
  background-position-y: $background-offset;
}

@mixin bar-animation {
  transition-property: translate, box-shadow;
  transition-duration: #{token(transition-duration)};
  transition-timing-function: #{token(transition-timing)};
}

@mixin segmented-animation {
  transition-property: background;
  transition-duration: #{token(transition-duration)};
  transition-timing-function: #{token(transition-timing)};
}

@mixin segmented-bar-animation {
  transition-property: translate, box-shadow, background;
  transition-duration: #{token(transition-duration)};
  transition-timing-function: #{token(transition-timing)};
}

@mixin tickmarks-animation {
  transition-property: background;
  transition-duration: #{token(transition-duration)};
  transition-timing-function: #{token(transition-timing)};
}

/* stylelint-disable custom-property-pattern */
// Manually reference the height of the meter group to avoid a circular dependency. Use half the
// meter group's height to extend the meter behind the radius of the preceding meter.
$leading: calc(var(--_meter-group-height) * 0.5);
/* stylelint-enable custom-property-pattern */

@mixin grouped {
  display: block;
  position: absolute;
  z-index: var(--_meter-z-index);
  inset-block-start: 0;
  inset-inline-start: var(--_meter-inset, 0);
  block-size: 100%;
  inline-size: calc(var(--_meter-percentage) + $leading);
  border-radius: #{token(inner-shape)};
  border-start-start-radius: 0;
  border-end-start-radius: 0;
  margin-inline-start: calc(-1 * $leading);
  background: #{token(color)};
  box-shadow: #{token(inner-elevation)};
}

@mixin vertical-grouped {
  display: block;
  inset-block-start: calc(100% - var(--_meter-percentage) - (var(--_meter-inset, 0)));
  inset-inline-start: 0;
  block-size: calc(var(--_meter-percentage) + $leading);
  inline-size: 100%;
  max-inline-size: initial;
  border-radius: #{token(inner-shape)};
  border-end-start-radius: 0;
  border-end-end-radius: 0;
  margin-block-end: calc(-1 * $leading);
  margin-inline-start: 0;
}
