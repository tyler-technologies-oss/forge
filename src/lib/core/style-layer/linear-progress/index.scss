@use './variables';
@use './core';
@use './animations';

@forward './variables';
@forward './core';
@forward './animations';

///
/// Creates selectors for the standard circular progress structure
/// 
@mixin styles {
  @include base-styles;
  @include indeterminate-styles;
  @include rtl;
  @include forced-colors;
  @include animations.keyframes;
}

///
/// Selectors for the base container structure
/// 
@mixin base-styles {
  @layer base {
    .#{variables.$prefix} {
      @include core.configuration;
      @include core.progress;
    }

    .#{variables.$prefix},
    .track,
    .buffer-bar,
    .bar,
    .bar-inner {
      position: absolute;
    }

    .bar {
      @include core.bar;
    }

    .secondary-bar {
      @include core.secondary-bar;
    }

    .bar-inner {
      @include core.bar-inner;
    }

    .buffer-bar {
      @include core.buffer-bar;
    }

    .track {
      @include core.track;
    }
  }
}

///
/// Selectors for the indeterminate structure
/// 
@mixin indeterminate-styles {
  @layer indeterminate {
    .#{variables.$prefix}--indeterminate {
      .bar {
        @include core.indeterminate-bar;
      }
    
      .primary-bar {
        @include core.indeterminate-primary-bar;
      }
    
      .secondary-bar {
        @include core.indeterminate-secondary-bar;
      }
    
      .track {
        @include core.indeterminate-track;
      }
    
      .primary-bar > .bar-inner {
        @include core.indeterminate-primary-bar-inner;
      }
    
      .secondary-bar > .bar-inner {
        @include core.indeterminate-secondary-bar-inner;
      }
    }
  }
}

@mixin rtl {
  $rtl-selectors: (
    ':host-context([dir="rtl"]) .' + variables.$prefix,
    ':host([dir="rtl"]) .' + variables.$prefix,
    '.' + variables.$prefix + ':dir(rtl)'
  );

  @each $selector in $rtl-selectors {
    #{$selector} {
      .bar {
        transform-origin: right center;
      }

      .buffer-bar {
        transform-origin: right center;
      }

      .track {
        animation-name: buffering-rtl;
      }

      &.forge-linear-progress--indeterminate .primary-bar {
        animation-name: primary-indeterminate-translate-rtl;
      }

      &.forge-linear-progress--indeterminate .secondary-bar {
        animation-name: secondary-indeterminate-translate-rtl;
      }
    }
  }
}

///
/// Provides selectors to support forced-colors mode
/// 
@mixin forced-colors {
  @media screen and (forced-colors: active) {
    .#{variables.$prefix} {
      --_active-indicator-color: canvastext;
      --_track-color: graytext;
      border: 1px solid canvastext;
    }

    .#{variables.$prefix}--indeterminate.#{variables.$prefix} {
      --_track-color: canvas;
    }
  }
}
