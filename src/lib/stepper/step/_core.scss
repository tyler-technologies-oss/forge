
@use '@material/ripple/ripple' as mdc-ripple;
@use '@material/ripple/ripple-theme' as mdc-ripple-theme;
@use '../../theme';
@use '../../core/styles/typography';

@use './token-utils' as *;

@forward './token-utils';

@mixin core-styles() {
  .forge-step {
    @include base();
    @include forge-interactable();

    .container {
      display: contents;
    }

    .expansion-panel {
      display: none;
    }

    .expanded-icon {
      @include theme.property(color, icon-color);

      display: none;
      margin-left: auto;
    }

    .title {
      @include label();
    }

    .subtitle {
      @include optional-label-slot-wrapper;

      ::slotted(*) {
        @include optional-label();
      }
    }

    .icon-container {
      .forge-step-icon-content {
        @include icon-content;
      }
    }

    // &:not(.forge-step--disabled) {
    //   .forge-step-icon-content {
    //     @include icon-content-color;
    //   }
    // }

    &--disabled {
      cursor: not-allowed;

      &.forge-step {
        .icon-container {
          .forge-step-icon-content {
            @include icon-content-disabled;
          }
        }
      }

      color: #{token(disabled-text-color)};
      .text-container {
        .title {
          color: #{token(disabled-text-color)};
        }

        .subtitle {
          ::slotted(*) {
            color: #{token(disabled-text-color)};
          }
        }
      }
    }

    &--alternative {
      flex-direction: column;

      .icon-container {
        .forge-step-icon-content {
          margin: 0;
        }
      }
      .text-container {
        @include text-container-alternative;

        place-items: center;
      }
    }

    &:not(.forge-step--selected):not(.forge-step--disabled) {
      &:not(.forge-step--editable):not(.forge-step--completed),
      &.forge-step--editable:not(.forge-step--completed) {
        &:not(.forge-step--error) {
          .forge-step-icon-content {
            @include icon-content-default-theme;

            .forge-step-index {
              color: #{token(primary-color)};
            }
          }
        }
      }
    }

    &--selected {
      &.forge-step--disabled {
        .forge-step-icon-content {
          @include icon-content-disabled();
        }
      }

      &:not(.forge-step--disabled) {
        .icon-container {
          .forge-step-icon-content {
            @include icon-content-selected();
          }
        }
      }

      &:not(.forge-step--disabled) {
        .title {
          @include label-selected();
        }

        .subtitle {
          ::slotted(*) {
            @include optional-label-selected();
          }
        }
      }
    }

    &--error {
      &:not(.forge-step--disabled) {
        .title {
          @include label-error();
        }

        .subtitle {
          ::slotted(*) {
            @include optional-label-error();
          }
        }

        .icon-container {
          .forge-step-icon-content {
            @include icon-content-error();
          }
        }
      }
    }

    &--completed {
      &:not(.forge-step--disabled) {
        &:not(.forge-step--error) {
          &:not(.forge-step--editable) {
            .forge-step-icon-content {
              @include icon-content-completed();
            }
          }
          &.forge-step--editable {
            .forge-step-icon-content {
              @include icon-content-completed();
            }
          }
        }
      }
    }

    &--expandable {
      .expanded-icon {
        display: inline-block;
        transition: transform 300ms ease-in-out;
      }

      &.forge-step--expanded {
        .expanded-icon {
          transform: rotate(180deg);
        }
      }

      .icon-container {
        .forge-step-icon-content {
          margin: 0 16px 0 0;
        }
      }
    }

    .text-container {
      @include text-container();
    }
  }
}

@mixin base() {
  padding: 12px 16px;
  outline: none;
  background: none;
  border: none;
  border-radius: 14px;
  position: relative;
  display: flex;
  overflow: hidden;
  align-items: center;
  z-index: 1;

  &:focus {
    outline: none;
  }

  &::-moz-focus-inner,
  &::-moz-focus-outer {
    padding: 0;
    border: 0;
  }
}

@mixin forge-interactable() {
  @include mdc-ripple.surface;
  @include mdc-ripple.radius-bounded;
  @include mdc-ripple-theme.states;
  @include mdc-ripple-theme.states-selected(primary);

  cursor: pointer;

  &.forge-step--error.forge-step {
    @include mdc-ripple-theme.states-selected(error);
  }

  &--selected {
    // @include mdc-theme.property(color, primary);
    color: #{token(primary-color)};
  }

  &--disabled {
    &::before,
    &::after {
      background-color: transparent;
    }
  }
}

@mixin icon-content-default-theme {
  border-color: #{token(primary-color)};
}

@mixin icon-content() {
  color: #{token(icon-text-color)};
  background-color: #{token(icon-fill)};
  height: #{token(icon-content-size)};
  width: #{token(icon-content-size)};

  border-style: solid;
  border-width: 2px;
  border-color: transparent;
  border-radius: 50%;

  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1);
  margin: 0 8px 0 0;
  flex: none;

  forge-icon {
    font-size: #{token(icon-size)};
  }
}

@mixin icon-content-selected() {
  @include override(icon-fill, icon-fill-active);
  @include override(icon-text-color, icon-text-color-active);
}

@mixin icon-content-completed() {
  @include icon-content-selected();
}

@mixin icon-content-error {
  @include override(icon-fill, error-color);
  @include override(icon-text-color, error-text-color);
}

@mixin icon-content-disabled {
  @include override(icon-fill, disabled-color);
  @include override(icon-text-color, disabled-text-color);
}

@mixin line() {
  border-color: #{token(line-color)};

  border-top-style: solid;
  border-top-width: 1px;
  border-radius: 1px 0 0 1px;
}

@mixin step-line() {
  border-color: #{token(line-color)};

  content: '';
  position: relative;
  height: 0;
  min-width: 10px;
  flex: 1;
  flex-basis: 0.000000001px;
  border-top-style: solid;
  border-top-width: 1px;
  border-radius: 1px 0 0 1px;
}

@mixin text-container() {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

@mixin text-container-alternative {
  margin-top: 8px;
}

@mixin label {
  @include typography.style(body1);

  color: #{token(label-color)};

  text-align: left;
  overflow: hidden;
  text-overflow: ellipsis;
}

@mixin label-selected {
  color: #{token(primary-color)};

  font-weight: 500;
}

@mixin label-error {
  color: #{token(error-color)};
}

@mixin optional-label {
  color: #{token(sub-label-color)};

  @include typography.style(label1);
}

@mixin optional-label-slot-wrapper {
  text-align: left;
  overflow: hidden;
  text-overflow: ellipsis;
}

@mixin optional-label-selected {
  color: #{token(primary-color)};

  font-weight: 500;
}

@mixin optional-label-error {
  color: #{token(error-color)};
}

@mixin border-psudo-styles($host-selector) {
  :host(:not(:last-child)#{$host-selector}) {
    &::after {
      @content;
    }
  }

  :host(:last-child#{$host-selector}) {
    &::before {
      @content;
    }
  }

  :host(:not(:first-child):not(:last-child)#{$host-selector}) {
    &::before,
    &::after {
      @content;
    }
  }
}

@mixin vertical-base {
  width: 100%;
  border-radius: 4px;
  min-height: 52px;
}

@mixin vertical-host {
  flex-direction: column;
}

@mixin expansion-panel-styles {
  border-color: #{token(line-color)};
  margin-left: #{token(expansion-panel-margin-left)};
  margin-top: #{token(expansion-panel-margin-top)};
  margin-bottom: #{token(expansion-panel-margin-bottom)};
  border-left-width: #{token(expansion-panel-border-left-width)};

  border-left-style: solid;
}

@mixin forge-ignore-user-expansion {
  .forge-step {
    .expanded-icon {
      display: none;
    }
  }
}
