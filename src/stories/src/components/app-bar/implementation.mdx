import { Story } from '@storybook/addon-docs';
import AppBarDemoBasic, { AppBarDemoBasicCodeHtml } from '../../../components/demos/app-bar/app-bar-demo-basic';
import AppBarDemoMenu, { AppBarDemoMenuCodeHtml, AppBarDemoMenuCodeTs } from '../../../components/demos/app-bar/app-bar-demo-menu';
import AppBarDemoSearch, { AppBarDemoSearchCodeHtml, AppBarDemoSearchCodeTs } from '../../../components/demos/app-bar/app-bar-demo-search';
import AppBarDemoFull, { AppBarDemoFullCodeHtml } from '../../../components/demos/app-bar/app-bar-demo-full';
import AppBarDemoNotificationButton, { AppBarDemoNotificationButtonCodeHtml } from '../../../components/demos/app-bar/app-bar-demo-notifications';
import AppBarDemoProfileButton, { AppBarDemoProfileButtonCodeHtml, AppBarDemoProfileButtonCodeTs } from '../../../components/demos/app-bar/app-bar-demo-profile';
import AppBarDemoHelpButton, { AppBarDemoHelpButtonCodeHtml, AppBarDemoHelpButtonCodeTs } from '../../../components/demos/app-bar/app-bar-demo-help-button';

<PageSection>

# App Bar Implementation

This guide will help walk you through the process of integrating an application with the Forge app-bar web components.
You will learn about design decisions, and how to integrate these components into your application. If you have
further questions/concerns please provide feedback directly to the Forge team via service desk, or on slack under
the `#tyler-forge` channel.

</PageSection>

<PageSection>

## Design decisions

There have been a few iterations of app-bar in the past. It has undergone style changes, functional changes… etc.
but there has always been a need to adjust it slightly on a per-application basis. Previously this required
including the functionality within the component itself, further bloating its scope. 

The intention going forward is to provide a set of components that can be “composed” to create the experience you
are looking for. Instead of providing all functionality into a single component, the app-bar has been split up into
various individual components that can be used together. This helps keep component responsibilities lean, while
still providing the consistency and flexibility that Tyler applications need.

</PageSection>

<PageSection>

## Components

Let's start by introducing you to the various app-bar-related components that are available:

### App Bar

The app-bar component itself is just a simple component the provides common styles, structure, and typography.
It is the most basic implementation that you can get. By itself, it's nothing more than a container with a
background color, logo and title. The power of using this component starts to shine when you look at it from
the stand point of consistency. Every Tyler application should have a consistent header. The elements within
that header can differ slightly, but overall this component will provide that base consistency.

<LiveDemo layout='column' fullWidth codeHtml={AppBarDemoBasicCodeHtml()}>
  <AppBarDemoBasic />
</LiveDemo>

### Menu button

The menu button is nothing more than a predefined icon button. This component ensures that every application
that needs to display a menu icon button will do so in the same way. It can be placed within the menu slot of
the app-bar component.

<LiveDemo layout='column' fullWidth codeHtml={AppBarDemoMenuCodeHtml()} codeTs={AppBarDemoMenuCodeTs()}>
  <AppBarDemoMenu />
</LiveDemo>

> You can bind a click event listener directly on the `<forge-app-bar-menu-button>` component, and when the user
> clicks the internal `<button>` element, the event will bubble up through to the component.
>
> See the <GatsbyLink to="/components/app-bar-menu-button/development">API details</GatsbyLink> for the `<forge-app-bar-menu-button>` component for more information.

### Search

This component is an input element that is styled to look natural within the app-bar. The intention is that this
component will be placed in the `center` slot, and used to provide global and/or local searching within an application.

<LiveDemo layout='column' fullWidth codeHtml={AppBarDemoSearchCodeHtml()} codeTs={AppBarDemoSearchCodeTs()}>
  <AppBarDemoSearch />
</LiveDemo>

You can listen for the `forge-app-bar-search` event on the component to know when the user has executed the search.

> Note that the `input` element is slotted in and left exposed to allow for easily binding to it using standard
> event listeners and/or various framework binding syntax without having to proxy all events and properties of
> the element through the Web Component.
> 
> See the <GatsbyLink to="/components/app-bar-search/development">API details</GatsbyLink> for the `<forge-app-bar-search>` component for more information.

### Profile button

The profile button offers a common user avatar, and profile card within a popup. The intention of this component
is to display the logged-in user information, as well as provide them the ability to (optionally) sign out. This
component should be placed in the `profile` slot.

<LiveDemo layout='column' fullWidth codeHtml={AppBarDemoProfileButtonCodeHtml()} codeTs={AppBarDemoProfileButtonCodeTs()}>
  <AppBarDemoProfileButton />
</LiveDemo>

> See the <GatsbyLink to="/components/app-bar-profile-button/development">API details</GatsbyLink> for the `<forge-profile-button>` component for more information.

### Help button

The help button component just provides a consistent icon button with access to populating options within the menu
that is displayed when clicked.

<LiveDemo layout='column' fullWidth codeHtml={AppBarDemoHelpButtonCodeHtml()} codeTs={AppBarDemoHelpButtonCodeTs()}>
  <AppBarDemoHelpButton />
</LiveDemo>

> See the <GatsbyLink to="/components/app-bar-help-button/development">API details</GatsbyLink> for the `<forge-app-bar-help-button>` component for more information.

### Notification button

The notification button currently just provides a consistent icon button, and facilities to show the notification
count. Listen for the `click` event on the element to show your notifications if necessary.

> **Note:** The goal in the future is to provide a common notification popup with enhanced functionality, but the
infrastructure to support this across Tyler does not exist yet...

<LiveDemo layout='column' fullWidth codeHtml={AppBarDemoNotificationButtonCodeHtml()}>
  <AppBarDemoNotificationButton />
</LiveDemo>

> See the <GatsbyLink to="/components/app-bar-notification-button/development">API details</GatsbyLink> for the `<forge-app-bar-notification-button>` component for more information.

</PageSection>

<PageSection>

## Implementation

The following sections will discuss the implementation details regarding each of the app-bar components noted above
by providing code snippets, best practices, and expectations for each in multiple technologies.

### Angular

Each of the app-bar components integrates seamlessly with Angular. Below you will find some common usage examples
for these components in Angular:

> **Disclaimer:** The following examples are overly-simplified on purpose to condense the content and convey the
> purpose and usage of each component. It is expected that the actual data would come from configuration and/or
> asynchronous services at runtime.

### Example template

```html
<forge-app-bar [titleText]="title">
  <!-- Listen for the native click event (maybe toggle the drawer?) -->
  <forge-app-bar-menu-button slot="menu" (click)="isDrawerOpen = !isDrawerOpen"></forge-app-bar-menu-button>

  <!-- Listen for the search event to handle searching (the event.detail property contains the search text) -->
  <forge-app-bar-search slot="center" (forge-app-bar-search-input)="onSearch($event)">
      <input type="text" placeholder="Search..." />
  </forge-app-bar-search>
  
  <!-- Bind your options array -->
  <forge-app-bar-help-button slot="action" [options]="helpOptions" (forge-menu-select)="onHelpSelected($event)"></forge-app-bar-help-button>

  <!-- Bind your notification count -->
  <forge-app-bar-notification-button slot="action" [count]="notificationCount" [dot]="useNotificationDot"></forge-app-bar-notification-button>

  <!-- Bind your optionsCallback -->
  <forge-app-bar-app-launcher-button slot="action" [optionsCallback]="appLauncherOptionsListener"></forge-app-bar-app-launcher-button>

  <!-- 
    Listen for multiple events and bind profile data.
    Use the profile-button attribute if your application supports user profiles.
  -->
  <forge-profile-button 
    *ngIf="isSignedIn"
    slot="profile"
    [avatarText]="user.username"
    [fullName]="user.username"
    [email]="user.email"
    profile-button
    (forge-profile-card-profile)="onProfileClicked()"
    (forge-profile-card-sign-out)="onSignOutClicked()">
  </forge-profile-button>

  <!-- Show a sign in button if the user is not signed in -->
  <forge-button slot="profile" type="unelevated" *ngIf="!isSignedIn" (click)="onSignInClicked()">
    <button type="button">Sign in</button>
  </forge-button>
</forge-app-bar>
```

### Example component class

```ts
import { Component, OnInit } from '@angular/core';
import { 
  IAppLauncherOptionsCallback,
  IAppLauncherOptionsResult,
  IAppBarSearchEventData,
  IMenuOption
} from '@tylertech/forge';

@Component({
  selector: 'app-bar-example',
  templateUrl: './app-bar-example.html'
})
export class AppBarExample implements OnInit {
  public isDrawerOpen = true; // Bind this to your <forge-drawer [open]="isDrawerOpen">
  public appLauncherOptionsListener: IAppLauncherOptionsCallback;
  public helpOptions: IMenuOption[] = [];
  public notificationCount: number;
  public useNotificationDot = false; // Use this to control the visibility of the count text in the notification badge
  public isSignedIn = false;
  public user: IUser; // Contains the current user information

  public ngOnInit(): void {
    // Set up our app-launcher options callback
    this.appLauncherOptionsListener = () => this._getAppLauncherOptions();

    // Initialize the options for the help menu
    this.helpOptions = [
      { label: 'Help', value: 'help' },
      { label: 'Tyler Community', value: 'community' },
      { label: 'Tyler Support', value: 'support' },
      { label: 'About', value: 'about' },
    ];

    // Go get your notification status (hard coding for simplicity)
    this.notificationCount = 3;
  }

  /** Called when the user hits enter in the search input. */
  public onSearch(evt: CustomEvent): void {
    const data = evt.detail as IAppBarSearchEventData;
    const searchText = data.value;
    const isCombined = data.combined;
    const searchContext = data.context;

    // TODO: Execute your search...
  }

  /** Called when selecting an item from the help menu. */
  public onHelpSelected(evt: CustomEvent): void {
    const index = evt.detail.index as number;
    const value = evt.detail.value as string;
    const helpOption = this.helpOptions[index];

    // TODO: Handle the selected help option appropriately
  }

  public onProfileClicked(): void {
    // TODO: Handle clicking the profile button
  }

  public onSignOutClicked(): void {
    // TODO: Handle clicking the sign out button
  }

  public onSignInClicked(): void {
    // TODO: Handle clicking the sign in button
  }

  private _getAppLauncherOptions(): Promise<IAppLauncherOptionsResult> {
    // In a real world application you would make an HTTP request here, and map the result
    // into an IAppLauncherOptionsResult type (structure shown below)
    return new Promise<IAppLauncherOptionsResult>(resolve => {
      resolve({ 
        options: [
          // This array contains objects of type IAppLauncherOption (should match the default intent type from your intents service)
        ]
      });
    });
  }
}
```

</PageSection>
